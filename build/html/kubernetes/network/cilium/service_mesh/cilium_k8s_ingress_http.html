<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cilium Kubernetes Ingress HTTP配置案例 &mdash; Cloud Atlas 0.1 文档</title>
      <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../../../_static/sphinxnotes-strike.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../../" id="documentation_options" src="../../../../_static/documentation_options.js"></script>
        <script src="../../../../_static/jquery.js"></script>
        <script src="../../../../_static/underscore.js"></script>
        <script src="../../../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../../../_static/doctools.js"></script>
        <script src="../../../../_static/translations.js"></script>
    <script src="../../../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../../../genindex.html" />
    <link rel="search" title="搜索" href="../../../../search.html" />
    <link rel="copyright" title="版权所有" href="../../../../copyright.html" />
    <link rel="next" title="Cilium 7层 流量管理" href="cilium_l7-aware_traffic_management.html" />
    <link rel="prev" title="Cilium Kubernetes Ingress" href="cilium_k8s_ingress.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../../../index.html" class="icon icon-home"> Cloud Atlas
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../../../studio/index.html">Studio Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infrastructure/index.html">Infrastructure Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../devops/index.html">DevOps Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kvm/index.html">KVM Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ceph/index.html">Ceph Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../gluster/index.html">Gluster Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../ovirt/index.html">oVirt Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../openstack/index.html">OpenStack Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../docker/index.html">Docker Atlas</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Kubernetes Atlas</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../kubernetes_overview.html">Kubernetes概览</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../startup_prepare/index.html">Kubernetes起步准备</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../startup/index.html">Kubernetes快速起步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../concepts/index.html">Kubernetes概念辨析</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../deployment/index.html">Kubernetes部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../deploy_app/index.html">Kubernetes部署应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../manage_object/index.html">Kubernetes管理对象</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../administer/index.html">Kubernetes管理</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../access_application/index.html">Kubernetes访问应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../container_runtimes/index.html">Kubernetes 容器运行时(Container Runtimes)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../configure/index.html">Kubernetes 配置</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../index.html">Kubernetes网络</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../../cni.html">容器网络接口(CNI)</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../k8s_network_infa.html">Kubernetes网络架构</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../ingress/index.html">Kubernetes Ingress控制器</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../flannel/index.html">Flannel网络</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html">Cilium网络</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="../intro_cilium.html">cilium技术简介</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cilium_startup.html">cilium快速起步</a></li>
<li class="toctree-l4"><a class="reference internal" href="../installation/index.html">Cilium网络安装</a></li>
<li class="toctree-l4"><a class="reference internal" href="../observability/index.html">Cilium网络可观测性</a></li>
<li class="toctree-l4"><a class="reference internal" href="../networking/index.html">Cilium网络配置</a></li>
<li class="toctree-l4"><a class="reference internal" href="../cilium_cluster_mesh.html">Cilium Cluster Mesh</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="index.html">Cilium Service Mesh</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../../calico/index.html">Calico网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../weave/index.html">weave网络</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../metallb/index.html">Kubernetes MetalLB 负载均衡</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../../in_action/index.html">Kubernetes实践</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../numa/index.html">Kubernetes NUMA</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../backup/index.html">Kubernetes备份与恢复</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../storage/index.html">Kubernetes存储</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../production/index.html">Kubernetes生产环境</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../service_mesh/index.html">Service Mesh</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../istio/index.html">Istio服务网格</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../serverless/index.html">Kubernetes Severless</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../ci_cd/index.html">Kubernetes持续集成和持续部署</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../monitor/index.html">Kubernetes监控</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../self_healing/index.html">Kubernetes 自愈</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../debug/index.html">Kubernetes排查</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../knative/index.html">Knative - Serverless计算</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../security/index.html">Kubernetes安全</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../virtual/index.html">Kubernetes结合虚拟化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../arm/index.html">ARM架构Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../k8s_android/index.html">Kubernetes运行Android</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../k3s/index.html">K3s - 轻量级Kubernetes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../cloud/index.html">Kubernetes云厂商</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../develop/index.html">Kubernetes开发</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kubernetes_from_scratch/index.html">Kubernetes From Scratch (KFS) Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rancher/index.html">Rancher Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../openshift/index.html">OpenShift Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sql/index.html">SQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../sqlite/index.html">SQLite Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mysql/index.html">MySQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../pgsql/index.html">PostgreSQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nosql/index.html">NoSQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../redis/index.html">Redis Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../network/index.html">Network Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infra_service/index.html">Infra-Service Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../infra_search/index.html">Search Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../info_service/index.html">Info-Service Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../web/index.html">Web Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../big_data/index.html">Big Data Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../machine_learning/index.html">Machine Learning Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../linux/index.html">Linux Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../kernel/index.html">Kernel Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../performance/index.html">Performance Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../distributed_system/index.html">Distributed System Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../shell/index.html">Shell Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../python/index.html">Python Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../django/index.html">Django Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../javascript/index.html">JavaScript Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../nodejs/index.html">Node.js Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../golang/index.html">Go Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../swift/index.html">Swift Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../rust/index.html">Rust Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../arm/index.html">ARM Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../android/index.html">Android Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../bsd/index.html">BSD Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../apple/index.html">Apple Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../windows/index.html">Windows Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../real/index.html">Real Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../management/index.html">Management Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../life/index.html">Life Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../donate.html">捐赠</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../roadmap.html">Roadmap</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../appendix/index.html">附录</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../../index.html">Cloud Atlas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../../index.html">Kubernetes Atlas</a> &raquo;</li>
          <li><a href="../../index.html">Kubernetes网络</a> &raquo;</li>
          <li><a href="../index.html">Cilium网络</a> &raquo;</li>
          <li><a href="index.html">Cilium Service Mesh</a> &raquo;</li>
      <li>Cilium Kubernetes Ingress HTTP配置案例</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../../../_sources/kubernetes/network/cilium/service_mesh/cilium_k8s_ingress_http.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="cilium-kubernetes-ingress-http">
<span id="cilium-k8s-ingress-http"></span><h1>Cilium Kubernetes Ingress HTTP配置案例<a class="headerlink" href="#cilium-kubernetes-ingress-http" title="Permalink to this heading">¶</a></h1>
<p>在完成 <a class="reference internal" href="cilium_k8s_ingress.html#cilium-k8s-ingress"><span class="std std-ref">Cilium Kubernetes Ingress</span></a> 部署之后，我们可以部署一个HTTP案例来验证，这里的案例是Cilium官方文档介绍的 <a class="reference internal" href="../../../istio/index.html#istio"><span class="std std-ref">Istio服务网格</span></a> 项目的一个 <code class="docutils literal notranslate"><span class="pre">bookinfo</span></code> demo microservices app</p>
<section id="demo-app">
<h2>部署Demo App<a class="headerlink" href="#demo-app" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>执行以下命令部署Demo:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">istio</span><span class="o">/</span><span class="n">istio</span><span class="o">/</span><span class="n">release</span><span class="o">-</span><span class="mf">1.11</span><span class="o">/</span><span class="n">samples</span><span class="o">/</span><span class="n">bookinfo</span><span class="o">/</span><span class="n">platform</span><span class="o">/</span><span class="n">kube</span><span class="o">/</span><span class="n">bookinfo</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
<li><p>部署完成后检查:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">pods</span>
</pre></div>
</div>
</li>
</ul>
<p>输出类似:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                              <span class="n">READY</span>   <span class="n">STATUS</span>    <span class="n">RESTARTS</span>   <span class="n">AGE</span>
<span class="n">details</span><span class="o">-</span><span class="n">v1</span><span class="o">-</span><span class="mi">586577784</span><span class="n">f</span><span class="o">-</span><span class="n">fwhmx</span>       <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
<span class="n">productpage</span><span class="o">-</span><span class="n">v1</span><span class="o">-</span><span class="mi">589</span><span class="n">b848cc9</span><span class="o">-</span><span class="n">lcx9x</span>   <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
<span class="n">ratings</span><span class="o">-</span><span class="n">v1</span><span class="o">-</span><span class="mi">679</span><span class="n">fc7b4f</span><span class="o">-</span><span class="n">bj8q9</span>        <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
<span class="n">reviews</span><span class="o">-</span><span class="n">v1</span><span class="o">-</span><span class="mi">7</span><span class="n">b76665ff9</span><span class="o">-</span><span class="mi">5</span><span class="n">t94l</span>       <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
<span class="n">reviews</span><span class="o">-</span><span class="n">v2</span><span class="o">-</span><span class="mi">6</span><span class="n">b86c676d9</span><span class="o">-</span><span class="n">dv4tm</span>       <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
<span class="n">reviews</span><span class="o">-</span><span class="n">v3</span><span class="o">-</span><span class="n">b77c579</span><span class="o">-</span><span class="mi">962</span><span class="n">sj</span>          <span class="mi">1</span><span class="o">/</span><span class="mi">1</span>     <span class="n">Running</span>   <span class="mi">0</span>          <span class="mi">28</span><span class="n">m</span>
</pre></div>
</div>
</section>
<section id="ingress">
<h2>部署第一个ingress<a class="headerlink" href="#ingress" title="Permalink to this heading">¶</a></h2>
<ul>
<li><p>部署ingress:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">apply</span> <span class="o">-</span><span class="n">f</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">raw</span><span class="o">.</span><span class="n">githubusercontent</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">cilium</span><span class="o">/</span><span class="n">cilium</span><span class="o">/</span><span class="mf">1.12.1</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="n">kubernetes</span><span class="o">/</span><span class="n">servicemesh</span><span class="o">/</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span><span class="o">.</span><span class="n">yaml</span>
</pre></div>
</div>
</li>
</ul>
<p>上述 <code class="docutils literal notranslate"><span class="pre">basic-ingress.yaml</span></code> 内容如下:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">部署ingress案例 basic-ingress.yaml</span><a class="headerlink" href="#id3" title="永久链接至代码">¶</a></div>
<div class="highlight-yaml notranslate"><div class="highlight"><pre><span></span><span class="c1"># Basic ingress for istio bookinfo demo application, which can be found in below</span><span class="w"></span>
<span class="c1"># https://raw.githubusercontent.com/istio/istio/release-1.11/samples/bookinfo/platform/kube/bookinfo.yaml</span><span class="w"></span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.k8s.io/v1</span><span class="w"></span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span><span class="w"></span>
<span class="nt">metadata</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">basic-ingress</span><span class="w"></span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span><span class="w"></span>
<span class="nt">spec</span><span class="p">:</span><span class="w"></span>
<span class="w">  </span><span class="nt">ingressClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cilium</span><span class="w"></span>
<span class="w">  </span><span class="nt">rules</span><span class="p">:</span><span class="w"></span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">http</span><span class="p">:</span><span class="w"></span>
<span class="w">        </span><span class="nt">paths</span><span class="p">:</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backend</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">details</span><span class="w"></span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9080</span><span class="w"></span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/details</span><span class="w"></span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span><span class="w"></span>
<span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">backend</span><span class="p">:</span><span class="w"></span>
<span class="w">              </span><span class="nt">service</span><span class="p">:</span><span class="w"></span>
<span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">productpage</span><span class="w"></span>
<span class="w">                </span><span class="nt">port</span><span class="p">:</span><span class="w"></span>
<span class="w">                  </span><span class="nt">number</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9080</span><span class="w"></span>
<span class="w">            </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span><span class="w"></span>
<span class="w">            </span><span class="nt">pathType</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Prefix</span><span class="w"></span>
</pre></div>
</div>
</div>
<p>上述案例将访问路径 <code class="docutils literal notranslate"><span class="pre">/details</span></code> 路由到 <code class="docutils literal notranslate"><span class="pre">details</span></code> 服务，而将 <code class="docutils literal notranslate"><span class="pre">/</span></code> 访问请求路由到 <code class="docutils literal notranslate"><span class="pre">productpage</span></code> 服务 (你可以将其视为 <a class="reference internal" href="../../../../web/nginx/index.html#nginx"><span class="std std-ref">Nginx</span></a> <code class="docutils literal notranslate"><span class="pre">locate</span></code> 指令，分别映射不同的后端)</p>
<ul>
<li><p>此时检查服务列表:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">svc</span>
</pre></div>
</div>
</li>
</ul>
<p>此时看到:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                           <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>       <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>   <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>        <span class="n">AGE</span>
<span class="n">cilium</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.100.187.26</span>    <span class="o">&lt;</span><span class="n">pending</span><span class="o">&gt;</span>     <span class="mi">80</span><span class="p">:</span><span class="mi">32598</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">11</span><span class="n">m</span>
<span class="n">details</span>                        <span class="n">ClusterIP</span>      <span class="mf">10.96.29.36</span>      <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9080</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">41</span><span class="n">m</span>
<span class="n">productpage</span>                    <span class="n">ClusterIP</span>      <span class="mf">10.107.25.111</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9080</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">41</span><span class="n">m</span>
<span class="n">ratings</span>                        <span class="n">ClusterIP</span>      <span class="mf">10.111.223.74</span>    <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9080</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">41</span><span class="n">m</span>
<span class="n">reviews</span>                        <span class="n">ClusterIP</span>      <span class="mf">10.97.184.48</span>     <span class="o">&lt;</span><span class="n">none</span><span class="o">&gt;</span>        <span class="mi">9080</span><span class="o">/</span><span class="n">TCP</span>       <span class="mi">41</span><span class="n">m</span>
</pre></div>
</div>
<p>需要注意，这里 <code class="docutils literal notranslate"><span class="pre">cilium-ingress-basic-ingress</span></code> 的外部IP <code class="docutils literal notranslate"><span class="pre">EXTERNAL-IP</span></code> 一直是 <code class="docutils literal notranslate"><span class="pre">pending</span></code> ，也就是没有分配上对外IP地址(实际上外部还访问不了)</p>
<ul>
<li><p>检查 <code class="docutils literal notranslate"><span class="pre">ingress</span></code> 确实也看到没有分配到地址(ADDRESS列是空的):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">ingress</span>
</pre></div>
</div>
</li>
</ul>
<p>输出显示没有分配外部地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>            <span class="n">CLASS</span>    <span class="n">HOSTS</span>   <span class="n">ADDRESS</span>   <span class="n">PORTS</span>   <span class="n">AGE</span>
<span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>   <span class="n">cilium</span>   <span class="o">*</span>                 <span class="mi">80</span>      <span class="mi">12</span><span class="n">m</span>
</pre></div>
</div>
<p>这里 <code class="docutils literal notranslate"><span class="pre">service</span></code> (svc) 没有分配外部IP( <code class="docutils literal notranslate"><span class="pre">EXTERNAL-IP</span></code> )是因为没有外部provider提供IP分配，这里我们为了简化，可以参考 <a class="reference external" href="https://stackoverflow.com/questions/44519980/assign-external-ip-to-a-kubernetes-service">Assign External IP to a Kubernetes Service</a> 手工配置一个固定IP地址。实际生产环境，需要部署IP分配服务，例如，可以参考 <a class="reference internal" href="../../dynamic_dns_loadbalancing_without_cloud_provider.html#dynamic-dns-loadbalancing-without-cloud-provider"><span class="std std-ref">没有云计算服务环境下动态DNS和负载均衡</span></a> 的方案，采用 <span class="xref std std-ref">metallb</span> 服务来分配IP地址和对外公告。</p>
<p>不过，参考 <a class="reference external" href="https://isovalent.com/blog/post/cilium-release-112/">Cilium 1.12 – Ingress, Multi-Cluster, Service Mesh, External Workloads, and much more</a> :</p>
<p>Dynamic Allocation of Pod CIDRs (beta)</p>
<p>When Cilium is the primary CNI, it is responsible for the allocation and management of IP addresses used by Kubernetes Pods. Cilium has many different IP Address Management (IPAM) modes, but the most popular choices for self-managed Kubernetes installations are the Kubernetes and Cluster Pool IPAM modes.</p>
<section id="external-ip">
<h3>手工分配EXTERNAL IP(不成功)<a class="headerlink" href="#external-ip" title="Permalink to this heading">¶</a></h3>
<p>这里我们为了简化，可以参考 <a class="reference external" href="https://stackoverflow.com/questions/44519980/assign-external-ip-to-a-kubernetes-service">Assign External IP to a Kubernetes Service</a> 手工配置一个固定IP地址。实际生产环境，需要部署IP分配服务，例如，可以参考 <a class="reference internal" href="../../dynamic_dns_loadbalancing_without_cloud_provider.html#dynamic-dns-loadbalancing-without-cloud-provider"><span class="std std-ref">没有云计算服务环境下动态DNS和负载均衡</span></a> 的方案，采用 <span class="xref std std-ref">metallb</span> 服务来分配IP地址和对外公告。
- 手工分配EXTERNAL-IP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">svc</span> <span class="n">cilium</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;{&quot;spec&quot;:{&quot;externalIPs&quot;:[&quot;192.168.6.151&quot;]}}&#39;</span>
</pre></div>
</div>
<p>提示信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">service</span><span class="o">/</span><span class="n">cilium</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span> <span class="n">patched</span>
</pre></div>
</div>
<p>此时检查 <code class="docutils literal notranslate"><span class="pre">svc</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">svc</span> <span class="n">cilium</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>
</pre></div>
</div>
<p>可以看到已经分配了外部IP:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>                           <span class="n">TYPE</span>           <span class="n">CLUSTER</span><span class="o">-</span><span class="n">IP</span>      <span class="n">EXTERNAL</span><span class="o">-</span><span class="n">IP</span>     <span class="n">PORT</span><span class="p">(</span><span class="n">S</span><span class="p">)</span>        <span class="n">AGE</span>
<span class="n">cilium</span><span class="o">-</span><span class="n">ingress</span><span class="o">-</span><span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>   <span class="n">LoadBalancer</span>   <span class="mf">10.100.187.26</span>   <span class="mf">192.168.6.151</span>   <span class="mi">80</span><span class="p">:</span><span class="mi">32598</span><span class="o">/</span><span class="n">TCP</span>   <span class="mi">85</span><span class="n">m</span>
</pre></div>
</div>
<p>但是，此时还访问不了这个IP，因为 <code class="docutils literal notranslate"><span class="pre">ingress</span></code> 还没有地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">get</span> <span class="n">ingress</span> <span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>
</pre></div>
</div>
<p>显示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">NAME</span>            <span class="n">CLASS</span>    <span class="n">HOSTS</span>   <span class="n">ADDRESS</span>   <span class="n">PORTS</span>   <span class="n">AGE</span>
<span class="n">basic</span><span class="o">-</span><span class="n">ingress</span>   <span class="n">cilium</span>   <span class="o">*</span>                 <span class="mi">80</span>      <span class="mi">88</span><span class="n">m</span>
</pre></div>
</div>
<ul>
<li><p>手工分配ingress相同IP(未找到方法):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">kubectl</span> <span class="n">patch</span> <span class="n">ingress</span> <span class="n">basic</span><span class="o">-</span><span class="n">ingress</span> <span class="o">-</span><span class="n">p</span> <span class="s1">&#39;{&quot;spec&quot;:{&quot;不知道这里填写什么&quot;:[&quot;192.168.6.151&quot;]}}&#39;</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">备注</p>
<p>我放弃手工配置，还是参考 <a class="reference internal" href="../networking/ipam/index.html#cilium-ipam"><span class="std std-ref">Cilium IP 地址管理(IPAM)</span></a> 来分配IP地址, 待续</p>
</div>
</section>
</section>
<section id="id2">
<h2>参考<a class="headerlink" href="#id2" title="Permalink to this heading">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.cilium.io/en/stable/gettingstarted/servicemesh/http/">Cilium docs: Kubernetes Ingress Support &gt;&gt; Ingress HTTP Example</a></p></li>
</ul>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="cilium_k8s_ingress.html" class="btn btn-neutral float-left" title="Cilium Kubernetes Ingress" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="cilium_l7-aware_traffic_management.html" class="btn btn-neutral float-right" title="Cilium 7层 流量管理" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../../../copyright.html"> 版权所有</a> 2018 - now, Huatai Huang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡</a></p>
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>