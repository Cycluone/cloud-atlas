

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="zh-CN" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="zh-CN" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Pixel VoLTE &mdash; Cloud Atlas 0.1 文档</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
        <script type="text/javascript" src="../../_static/language_data.js"></script>
        <script type="text/javascript" src="../../_static/translations.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="copyright" title="版权所有" href="../../copyright.html" />
    <link rel="next" title="设置Android Proxy" href="android_proxy.html" />
    <link rel="prev" title="Android反向Tethering" href="reverse_tethering.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> Cloud Atlas
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../studio/index.html">Studio Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvm/index.html">KVM Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph/index.html">Ceph Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gluster/index.html">Gluster Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ovirt/index.html">oVirt Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openstack/index.html">OpenStack Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Docker Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kubernetes/index.html">Kubernetes Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openshift/index.html">OpenShift Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/index.html">MySQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Web Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../big_data/index.html">Big Data Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machine_learning/index.html">Machine Learning Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/index.html">Linux Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed_system/index.html">Distributed System Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../django/index.html">Django Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Atlas</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Android Atlas</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../device/index.html">Android 设备</a></li>
<li class="toctree-l2"><a class="reference internal" href="../startup/index.html">Android 起步</a></li>
<li class="toctree-l2"><a class="reference internal" href="../install/index.html">Android 安装</a></li>
<li class="toctree-l2"><a class="reference internal" href="../google/index.html">Android的Google应用</a></li>
<li class="toctree-l2"><a class="reference internal" href="../build/index.html">Android 镜像制作</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Android Hack</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="magisk.html">Magisk</a></li>
<li class="toctree-l3"><a class="reference internal" href="change_build_prop.html">修改build.prop文件</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_busybox.html">Android系统Busybox</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_sshd.html">Android SSH服务</a></li>
<li class="toctree-l3"><a class="reference internal" href="vpn_hotspot.html">VPN Hotspot</a></li>
<li class="toctree-l3"><a class="reference internal" href="androidscreencast.html">AndroidScreencast控制Android</a></li>
<li class="toctree-l3"><a class="reference internal" href="scrcpy.html">scrcpy控制Android</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_usb_tethering.html">通过USB Tethering方式共享Android的Internet连接</a></li>
<li class="toctree-l3"><a class="reference internal" href="reverse_tethering.html">Android反向Tethering</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Pixel VoLTE</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#id2">硬件支持</a></li>
<li class="toctree-l4"><a class="reference internal" href="#magisk">运营商配置Magisk模块(失败)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#volte">手工配置VoLTE</a></li>
<li class="toctree-l4"><a class="reference internal" href="#build-prop">修改 build.prop</a></li>
<li class="toctree-l4"><a class="reference internal" href="#id3">参考</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="android_proxy.html">设置Android Proxy</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_pac.html">配置Android Proxy Auto-Config(PAC)</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_monitor.html">Android手机作为显示器</a></li>
<li class="toctree-l3"><a class="reference internal" href="android_otg.html">Android OTG</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../virtual/index.html">Android 虚拟化</a></li>
<li class="toctree-l2"><a class="reference internal" href="../bliss/index.html">Bliss ROMs / Bliss OS</a></li>
<li class="toctree-l2"><a class="reference internal" href="../develop/index.html">Android 开发</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../macos_ios/index.html">macOS &amp; iOS Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../real/index.html">Real Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">附录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../donate.html">捐助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Atlas</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Android Atlas</a> &raquo;</li>
        
          <li><a href="index.html">Android Hack</a> &raquo;</li>
        
      <li>Pixel VoLTE</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/android/hack/pixel_volte.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pixel-volte">
<span id="id1"></span><h1>Pixel VoLTE<a class="headerlink" href="#pixel-volte" title="永久链接至标题">¶</a></h1>
<p>入手 <a class="reference internal" href="../device/pixel.html#pixel"><span class="std std-ref">Pixel和Pixel XL</span></a> 手机，经过一周的调教，已经如丝般滑顺(前提是摈弃所有国产软件)，并且root之后的Android提供了超越iOS的便利之处。</p>
<p>然而，中国移动运营商摒弃2G/3G技术导致很多地方如果没有VoLTE的4G语音技术加持，几乎无法正常通话。这就遇到一个尴尬的难题：自从2010年，Google被迫退出中国市场之后，已经没有正式渠道能够获得官方的产品和技术支持。同样Pixel以及后几代产品，在中国市场上只有水货，并且没有得到运营商VoLTE的数据配置支持。这是中国消费者的悲哀…</p>
<div class="section" id="id2">
<h2>硬件支持<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<p>Pixel 和 Pixel XL硬件上是支持VoLTE技术的(2016底年印度市场Pixel已经通过更新Android Nougat 7.1.1 OTA支持VoLTE)，并且当前Google Android系统对于支持VoLTE技术是非常友好的，只要运营商提供了配置，就可以直接开启。然而，不幸的是在中国市场上的运营商都没有提供配置。</p>
<p>通过电话拨号: <code class="docutils literal notranslate"><span class="pre">*#*#4636#*#*</span></code> 可以进入 <code class="docutils literal notranslate"><span class="pre">Testing</span></code> 设置，然后再点 <code class="docutils literal notranslate"><span class="pre">Phone</span> <span class="pre">Info</span></code> 其中就可以看到 <code class="docutils literal notranslate"><span class="pre">VoLTE</span> <span class="pre">Provisioned</span></code> 是灰色不可设置项。</p>
<p>可以通过 <a class="reference external" href="https://github.com/edgd1er/voenabler">Magisk voenabler</a> (XDA原帖见 <a class="reference external" href="https://forum.xda-developers.com/apps/magisk/module-v4-volte-enabler-t3649613">VoLTE &amp; VoWiFi Enabler (2018-09-20)</a> ) 激活VoLTE功能，原理就是修改 <cite>vender/build.prop</cite> 添加激活volte的配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Debug Options</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">ims_volte_enable</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">volte_avail_ovr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">vt_avail_ovr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">wfc_avail_ovr</span><span class="o">=</span><span class="mi">1</span>

<span class="c1"># Radio Options</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">rat_on</span><span class="o">=</span><span class="n">combine</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">data_ltd_sys_ind</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">data_con_rprt</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">on</span><span class="o">.</span><span class="n">ims</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<p>从 <a class="reference external" href="https://github.com/Magisk-Modules-Repo">GitHub Magisk-Module-Repo</a> 下载… 目前已经没有直接下载的voenabler模块，不过原作者的 <a class="reference external" href="https://github.com/Toucan-Sam/VoEnabler">GitHub Toucan-Sam VoEnabler</a> 有很多fork出来的项目，例如 <a class="reference external" href="https://github.com/edgd1er/voenabler/releases">edgd1er / voenabler</a> 提供直接直接可用适合最新Magisk’s module template 20.x的版本，可以直接下载：<a class="reference external" href="https://github.com/edgd1er/voenabler/releases/download/v1.6/voenabler-v1.6.zip">voenabler-v1.6.zip</a></p>
<ul>
<li><p>将 <code class="docutils literal notranslate"><span class="pre">voenabler-v1.6.zip</span></code> 推送到手机:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">push</span> <span class="n">voenabler</span><span class="o">-</span><span class="n">v1</span><span class="o">.</span><span class="mf">6.</span><span class="n">zip</span> <span class="o">/</span><span class="n">sdcard</span><span class="o">/</span>
</pre></div>
</div>
</li>
<li><p>启动Magisk程序，然后选择菜单 <code class="docutils literal notranslate"><span class="pre">Modules</span></code> ，并点击屏幕上 <code class="docutils literal notranslate"><span class="pre">+</span></code> 按钮，并通过文件管理器找到 <code class="docutils literal notranslate"><span class="pre">voenabler-v1.6.zip</span></code> 进行安装</p></li>
<li><p>安装以后按照提示重启手机，重启以后在 <code class="docutils literal notranslate"><span class="pre">Settings</span> <span class="pre">=&gt;</span> <span class="pre">Network</span> <span class="pre">&amp;</span> <span class="pre">Internet</span> <span class="pre">=&gt;</span> <span class="pre">Mobile</span> <span class="pre">network</span></code> 中查看，就可以看到增加了一项 <code class="docutils literal notranslate"><span class="pre">VoLTE</span></code> 选项并且已经激活：</p></li>
</ul>
<div class="figure align-default">
<a class="reference internal image-reference" href="../../_images/volte_pixel.png"><img alt="../../_images/volte_pixel.png" src="../../_images/volte_pixel.png" style="width: 341.25px; height: 600.0px;" /></a>
</div>
<ul class="simple">
<li><p>验证VoLTE功能：</p></li>
</ul>
<p>启用LTE 4G上网浏览网页，同时拨打10086听语音，如果语音同时还能够上网，则表示VoLTE工作正常。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>很不幸，虽然此时激活了VoLTE开关，但是实际上该功能还是无效的，电话同时并不能上网。这是因为此时手机中缺少中国地区运营商参数配置(因为Google压根就没有和中国三大运营商合作 - 中国政府不会允许的)。解决方法是从其他国产手机(如小米)提取国内运营商的VoLTE配置，制作成Magisk模块加载。</p>
</div>
</div>
<div class="section" id="magisk">
<h2>运营商配置Magisk模块(失败)<a class="headerlink" href="#magisk" title="永久链接至标题">¶</a></h2>
<p>参考宁静的雨 <a class="reference external" href="https://sspai.com/post/53949">开通VoLTE后发现Pixel手机不支持？装上这个Magisk模块就好了</a> 下载其提供的 VoLTE配置包 也通过Magisk加入。这个配置软件包也可以从 <a class="reference external" href="https://github.com/muink/magisk-pixel2-china-volte">magisk-pixel2-china-volte</a> 获得。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>上述方法是针对Pixel 2/2XL，我在Pixel XL上验证没有效果。原因是每款产品的配置文件目录实际是不同的，例如 Pixel 2 和 Pixel 2XL的运营商配置目录不同，相应的Pixel一代的运营商配置也有差异。</p>
</div>
<p>在 <code class="docutils literal notranslate"><span class="pre">/firmware/radio/modem_pr/mcfg/configs/mcfg_sw/generic/common/wildcard/wildcard</span></code> 文件中有包含中国移动波段:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>&lt;!-- China LTE Bands: 1, 3, 5, 7, 8, 38, 39, 40, 41  --&gt;
&lt;rf_band_list name=&quot;china_bands&quot;&gt;
   &lt;gw_bands base=&quot;hardware&quot;/&gt;
   &lt;lte_bands base=&quot;none&quot;&gt;
      &lt;include&gt; 0 2 4 6 7 37 38 39 40 &lt;/include&gt;
   &lt;/lte_bands&gt;
   &lt;tds_bands base=&quot;hardware&quot;/&gt;
&lt;/rf_band_list&gt;
</pre></div>
</div>
<p>在安装了上述magisk的module之后 <code class="docutils literal notranslate"><span class="pre">/sbin/.magisk/mirror/data</span></code> 目录下可以找到 <code class="docutils literal notranslate"><span class="pre">mcfg_sw</span></code> 配置目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">misc</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
<span class="o">./</span><span class="n">misc</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
</pre></div>
</div>
<p>其中 <code class="docutils literal notranslate"><span class="pre">/sbin/.magisk/mirror/data/misc/radio/modem_config/mcfg_sw/generic</span></code> 目录下包含了 <code class="docutils literal notranslate"><span class="pre">china</span></code> 目录 以及 <code class="docutils literal notranslate"><span class="pre">common</span></code> 目录。</p>
<p>更进一步可以看到 <code class="docutils literal notranslate"><span class="pre">/sbin/.magisk/mirror/data/misc/radio/modem_config/mcfg_sw/generic/common/wildcard/wildcard/mcfg_sw.mbn</span></code> 配置文件</p>
</div>
<div class="section" id="volte">
<h2>手工配置VoLTE<a class="headerlink" href="#volte" title="永久链接至标题">¶</a></h2>
<p>在 <a class="reference external" href="http://bbs.gfan.com/android-9536094-1-1.html">Pixel2(2XL) Anroid 8+/9.0 破解电信4G网络+开启VOLTE通话</a> 提供了完整的手工设置方法(在2楼是中国移动配置方法)，虽然是Pixel 2/2XL，不过可以借鉴尝试。</p>
<ul class="simple">
<li><p>下载 <a class="reference external" href="https://pan.baidu.com/s/1Fw01aG0ZqeDOOya57zIDYA">pixel2/2xl配置调整包</a> 下载后解压缩，其中有一个目录 <code class="docutils literal notranslate"><span class="pre">modem_pr/mcfg/configs/mcfg_sw/generic/china</span></code> 子目录，这个子目录完整复制到下一步所说的手机内部的对应目录：</p>
<ul>
<li><p>Pixel 2: <code class="docutils literal notranslate"><span class="pre">vendor/rfs/msm/mpss/readonly/mbn/mcfg/configs/mcfgsw/generic/</span></code></p></li>
<li><p>Pixel 2XL: <code class="docutils literal notranslate"><span class="pre">vendor/mbn/mcfg/configs/mcfg_sw/generic</span></code></p></li>
</ul>
</li>
</ul>
<p>由于我是Pixel XL，搜索目录 <code class="docutils literal notranslate"><span class="pre">mcfg_sw</span></code> 可以看到</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
<span class="o">./</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
<span class="o">./</span><span class="n">firmware</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_pr</span><span class="o">/</span><span class="n">mcfg</span><span class="o">/</span><span class="n">configs</span><span class="o">/</span><span class="n">mcfg_sw</span>
<span class="o">./</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">mirror</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
<span class="o">./</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">mirror</span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span>
</pre></div>
</div>
<p>其中最后2条是之前安装过Magisk的模块保留的？所以可能需要存放运营商配置的是前3个目录。分别检查这3个目录下的 <code class="docutils literal notranslate"><span class="pre">generic</span></code> 子目录，其中2个目录包含了各地运营商的配置信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span><span class="o">/</span><span class="n">generic</span>
<span class="o">/</span><span class="n">firmware</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_pr</span><span class="o">/</span><span class="n">mcfg</span><span class="o">/</span><span class="n">configs</span><span class="o">/</span><span class="n">mcfg_sw</span><span class="o">/</span><span class="n">generic</span>
</pre></div>
</div>
<p>但是，其中后一个目录 <code class="docutils literal notranslate"><span class="pre">/firmware/radio/modem_pr/mcfg/configs/mcfg_sw/generic</span></code> 是系统目录，只读无法写入。</p>
<p>参考 <a class="reference external" href="http://bbs.gfan.com/android-9538649-1-1.html">pixel XL VOLTE求助</a> 有人提到 pixel的目录应该是这个 <code class="docutils literal notranslate"><span class="pre">/firmware/radio/modem_pr/mcfg/configs/mcfg_sw/generic/common</span></code></p>
<p>但是如何写入这个目录是一个疑问？</p>
<p>所以推断应该将中国运营商的配置信息存放到 <code class="docutils literal notranslate"><span class="pre">/data/misc/radio/modem_config/mcfg_sw/generic</span></code> 目录下，在没有添加中国运营商配置信息之前，该目录下有5个子目录，分别代表欧洲、北美、亚太等5个地区:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">apac</span> <span class="n">aus</span> <span class="n">common</span> <span class="n">eu</span> <span class="n">na</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>如果使用Pixel 2/2XL则：</p>
<ul class="simple">
<li><p>Pixel 2目录 <code class="docutils literal notranslate"><span class="pre">vendor/rfs/msm/mpss/readonly/mbn/mcfg/configs/mcfgsw/generic/</span></code></p></li>
<li><p>Pixel 2XL目录 <code class="docutils literal notranslate"><span class="pre">vendor/mbn/mcfg/configs/mcfg_sw/generic</span></code></p></li>
</ul>
</div>
<p>我们需要把解压缩的文件中 <code class="docutils literal notranslate"><span class="pre">china</span></code> 文件夹复制进去，成为并列的第6个文件夹。不过直接用 <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">push</span> <span class="pre">china</span> <span class="pre">&lt;目标目录&gt;</span></code> 都提示 <code class="docutils literal notranslate"><span class="pre">Permission</span> <span class="pre">denied</span></code></p>
<p>所以先使用 <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">push</span> <span class="pre">china</span> <span class="pre">/sdcard</span></code> 将文件传输到手机内的存储目录，然后再在手机内部执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cd</span> <span class="o">/</span><span class="n">data</span><span class="o">/</span><span class="n">misc</span><span class="o">/</span><span class="n">radio</span><span class="o">/</span><span class="n">modem_config</span><span class="o">/</span><span class="n">mcfg_sw</span><span class="o">/</span><span class="n">generic</span>
<span class="n">cp</span> <span class="o">-</span><span class="n">R</span> <span class="o">/</span><span class="n">sdcard</span><span class="o">/</span><span class="n">china</span> <span class="o">./</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>检查发现实际上安装了 Magisk 的 <code class="docutils literal notranslate"><span class="pre">enable_volte_pixel2_china.zip</span></code> ，系统会挂载2个目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">block</span><span class="o">/</span><span class="n">vendor</span> <span class="mi">295</span><span class="n">M</span>  <span class="mi">249</span><span class="n">M</span>   <span class="mi">46</span><span class="n">M</span>  <span class="mi">85</span><span class="o">%</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">mirror</span><span class="o">/</span><span class="n">vendor</span>
<span class="o">/</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">block</span><span class="o">/</span><span class="n">data</span>   <span class="mi">112</span><span class="n">G</span>   <span class="mi">11</span><span class="n">G</span>  <span class="mi">101</span><span class="n">G</span>  <span class="mi">11</span><span class="o">%</span> <span class="o">/</span><span class="n">sbin</span><span class="o">/.</span><span class="n">magisk</span><span class="o">/</span><span class="n">mirror</span><span class="o">/</span><span class="n">data</span>
</pre></div>
</div>
<p>这样应该是一个overlay的解决方案，如果后续改成Magisk方式，可以尝试执行如下方式overlay。</p>
</div>
<ul class="simple">
<li><p>上述步骤完成以后，就会发现开启了工程模式查看 phone info 中，原先灰色的 <code class="docutils literal notranslate"><span class="pre">VoLTE</span> <span class="pre">Provisioned</span></code> 虽然还是灰色，但是灰色部分却显示为激活状态(虽然看上去不能调整)。这比之前始终灰色且关闭状态前进了一步。</p></li>
</ul>
</div>
<div class="section" id="build-prop">
<h2>修改 build.prop<a class="headerlink" href="#build-prop" title="永久链接至标题">¶</a></h2>
<p>Andorid 6.0之后不能直接修改只读的 <code class="docutils literal notranslate"><span class="pre">/system</span></code> 分区，所以我们需要使用 <code class="docutils literal notranslate"><span class="pre">systemless</span></code> 方式的 <a class="reference internal" href="magisk.html#magisk"><span class="std std-ref">Magisk</span></a> 来overlay修改系统配置。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>我暂时还没有找到修订 build.prop 的方法，但是我觉得magisk通过overlay可以修订。此外，既然 一加3T 和 小米 5s 是和Pixel同样的CPU，应该可以借鉴他们的image来解决Pixel的VoLTE。我准备下载这两个国产手机的rom来找寻VoLTE配置。</p>
</div>
<ul>
<li><p>(未找到该文件，没有执行)在gneric同级目录下有一个 <code class="docutils literal notranslate"><span class="pre">oem-sw.txt</span></code> 文件，在最后添加如下内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mcfg_sw</span><span class="o">/</span><span class="n">generic</span><span class="o">/</span><span class="n">china</span><span class="o">/</span><span class="n">cmcc</span><span class="o">/</span><span class="n">commerci</span><span class="o">/</span><span class="n">volte_op</span><span class="o">/</span><span class="n">mcfg_sw</span><span class="o">.</span><span class="n">mbn</span>
</pre></div>
</div>
</li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">build.prop</span></code> 文件中添加以下内容激活volte代码</p></li>
</ul>
<p>常规是需要修改 <code class="docutils literal notranslate"><span class="pre">/system/build.prop</span></code> 配置的，但是在android 10中，默认不能读写根文件系统。并且以前采用的命令:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">-</span><span class="n">o</span> <span class="n">remount</span><span class="p">,</span><span class="n">rw</span> <span class="o">/</span>
</pre></div>
</div>
<p>会提示报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;/dev/root&#39;</span> <span class="ow">is</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
</pre></div>
</div>
<p>解决方法是参考 <a class="reference external" href="https://android.stackexchange.com/questions/186630/android-o-failed-to-mount-system-dev-block-dm-0-is-read-only">Android O, failed to mount /system, /dev/block/dm-0 is read only</a> 执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">root</span>
<span class="n">adb</span> <span class="n">disable</span><span class="o">-</span><span class="n">verity</span>
<span class="n">adb</span> <span class="n">reboot</span>
<span class="n">adb</span> <span class="n">remount</span>
<span class="n">adb</span> <span class="n">shell</span>
<span class="n">mount</span> <span class="o">-</span><span class="n">o</span> <span class="n">rw</span><span class="p">,</span><span class="n">remount</span> <span class="o">/</span><span class="n">system</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>需要注意，上述 <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">disable-verity</span></code> 只能在 <code class="docutils literal notranslate"><span class="pre">userdebug</span></code> builds使用，默认通过 <code class="docutils literal notranslate"><span class="pre">cat</span> <span class="pre">/system/build.prop</span> <span class="pre">|</span> <span class="pre">grep</span> <span class="pre">build.type</span></code> 可以看到:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">system</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">user</span>
<span class="n">ro</span><span class="o">.</span><span class="n">build</span><span class="o">.</span><span class="n">type</span><span class="o">=</span><span class="n">user</span>
</pre></div>
</div>
<p>这种user模式下，执行 <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">disable-verity</span></code> 会报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">disable</span><span class="o">-</span><span class="n">verity</span> <span class="n">only</span> <span class="n">works</span> <span class="k">for</span> <span class="n">userdebug</span> <span class="n">builds</span>
<span class="n">verity</span> <span class="n">cannot</span> <span class="n">be</span> <span class="n">disabled</span><span class="o">/</span><span class="n">enabled</span> <span class="o">-</span> <span class="n">USER</span> <span class="n">build</span>
</pre></div>
</div>
</div>
<p>magisk提供了覆盖方法，在 <code class="docutils literal notranslate"><span class="pre">/sbin/.magisk/</span></code> 目录下搜索可以看到有如下配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">./</span><span class="n">mirror</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">odm</span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">prop</span>
<span class="o">./</span><span class="n">mirror</span><span class="o">/</span><span class="n">vendor</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">prop</span>
<span class="o">./</span><span class="n">mirror</span><span class="o">/</span><span class="n">system_root</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">product</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">prop</span>
<span class="o">./</span><span class="n">mirror</span><span class="o">/</span><span class="n">system_root</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">build</span><span class="o">.</span><span class="n">prop</span>
</pre></div>
</div>
<p>但是也不能修改(因为是软链接) <code class="docutils literal notranslate"><span class="pre">./mirror/system_root/system/build.prop</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">mtk_ims_support</span><span class="o">=</span><span class="mi">1</span>
<span class="n">ro</span><span class="o">.</span><span class="n">mtk_volte_support</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">mtk</span><span class="o">.</span><span class="n">volte</span><span class="o">.</span><span class="n">enable</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">volte_avail_ovr</span><span class="o">=</span><span class="mi">1</span>

<span class="c1"># 可能只要添加以上4行就可以</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">ims_volte_enable</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">volte_avail_ovr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">vt_avail_ovr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">dbg</span><span class="o">.</span><span class="n">wfc_avail_ovr</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">rat_on</span><span class="o">=</span><span class="n">combine</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">data_ltd_sys_ind</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">data_con_rprt</span><span class="o">=</span><span class="mi">1</span>
<span class="n">persist</span><span class="o">.</span><span class="n">radio</span><span class="o">.</span><span class="n">calls</span><span class="o">.</span><span class="n">on</span><span class="o">.</span><span class="n">ims</span><span class="o">=</span><span class="mi">1</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>非常失败，实际上没有搞定Android 10环境下激活Pixel的VoLTE，实在太折腾了。Pixel全系列不能在墙内使用VoLTE真是让人折磨死，即使后续各个版本，能够通过破解来激活VoLTE，但依然没有保障，任何升级都可能破坏激活。</p>
<p>看来，Pixel注定只能是移动终端兼备机角色了…</p>
</div>
</div>
<div class="section" id="id3">
<h2>参考<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.quora.com/Does-the-Google-Pixel-1-support-VoLTE">Does the Google Pixel 1 support VoLTE?</a></p></li>
<li><p><a class="reference external" href="https://forum.xda-developers.com/pixel-xl/help/how-to-enable-volte-pixel-t3685855">How to enable VoLTE on Pixel?</a></p></li>
<li><p><a class="reference external" href="https://forum.xda-developers.com/pixel-xl/how-to/guide-enable-china-telecom-lte-t3782538">Enable China Telecom LTE by modifying modem partitions</a> - 这个帖子是从一加手机中复制出运营商配置信息</p></li>
<li><p><a class="reference external" href="http://bbs.gfan.com/android-9536094-1-1.html">Pixel2(2XL) Anroid 8+/9.0 破解电信4G网络+开启VOLTE通话</a> - 这个帖子是指导如何手工一步步启用VoLTE的方法，对于直接使用Magisk包不生效的时候，可以尝试</p></li>
<li><p><a class="reference external" href="https://github.com/Magisk-Modules-Repo/chinese_sim_supporter">Magisk-Module-Repo/chinese_sim_supporter</a> 支持Pixel 3在中国运营商环境(中国移动/联通/电信)开启VoLTE</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="android_proxy.html" class="btn btn-neutral float-right" title="设置Android Proxy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="reverse_tethering.html" class="btn btn-neutral float-left" title="Android反向Tethering" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; <a href="../../copyright.html">Copyright</a> 2019, Huatai Huang

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡</a></p>
     


</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>