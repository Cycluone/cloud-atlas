.. _debug_lscpu_slow:

====================
排查lscpu缓慢
====================

我最近的一个案例：升级了服务器的内核，并且按照运行 :ref:`gvisor` 需求，开启了 :ref:`iommu` 相关内核参数。被升级的服务器是比较早期安装的系统，由于生产环境内核经过多次迭代，近期安装的内核版本看起来差异不大(仅小版本序号变化)，但是内核参数变化极大，而且还可能存在hotfix差异，所以我对安装软件包(kernel+hotfix)和内核参数进行了比对。

升级完内核，安装完hotfix包，并且使用 :ref:`grubby` 对内核参数差异进行订正，确保了升级后的服务器内核参数和新安装服务器完全一致，看起来应该没有问题了。

然而，我非常惊讶地发现，系统中出现了很多 ``lscpu`` 进程，每个进程都占用了 100% 的CPU资源:

.. literalinclude:: debug_lscpu_slow/top_lscpu
   :language: bash
   :caption: top显示大量的lscpu占用100%的CPU资源

参考
=====
