.. _choice_pi_storage:

=====================
树莓派存储设备选择
=====================

.. note::

   我感觉树莓派为了降低生产成本，没有集成能够满足桌面性能的存储芯片和接口实在是阉割了做作桌面或者服务器的能力。实际上，ARM的存储性能很弱，我不知道即将推出的苹果ARM架构笔记本/桌面设备如何解决这个存储性能问题。但至少，目前在树莓爱，外接USB的移动存储设备是提升系统性能非常重要的环节。

树莓派主板没有集成存储控制芯片，没有我们熟悉的SATA或m2存储接口，所以需要借用USB接口来实现硬盘存储访问。好在当前树莓派4b已经支持USB3.0接口，至少在访问接口上已经接近 500MB/s ，具有一定的实用性。

默认情况下树莓派Raspberry Pi是从SD卡启动系统的，但是SD卡存储容量有限，如果能够转换成磁盘启动（SSD/HDD）则可以实现一个海量的存储系统。


最初我以为树莓派可以通过扩展卡来支持SATA磁盘，后来参考 `Raspberry Pi: Adding an SSD drive to the Pi-Desktop kit <http://www.zdnet.com/article/raspberry-pi-adding-an-ssd-drive-to-the-pi-desktop-kit/>`_ 发现类似的解决方案是通过一种USB连接卡转换成 mSATA 或者 SATA接口，这样就类似于常用的USB接口移动硬盘连接。早期外接机械移动硬盘比较累赘，通过外接转接卡可以获得比较紧凑充满机械风的存储设备。

随着SSD技术进步，现在的外接SSD移动硬盘已经越做越小，摆脱了早期2.5寸移动硬盘的身影。我发现现在已经没有必要购买外接转接卡了，直接连接USB SSD存储器已经非常轻巧紧凑。推荐使用SSD移动存储作为树莓派存储设备。

`mSATA <https://baike.baidu.com/item/mSATA>`_ 是SATA技术整合在小尺寸装置的接口控制器规范。目前笔记本电脑开始使用这种接口用于固态硬盘。

如果存储连续性数据，例如视频，则需要大量的空间，并且顺序读取情况下机械硬盘和固态存储差距较小，出于成本考虑，依然可以采用传统的机械硬盘。

存储转接卡
===========

2018年我购买树莓派3b的时候，SSD存储还比较昂贵并且缺乏大容量规格。那时机械硬盘性价比较高(廉价)，所以我组建树莓派存储时候选择了2.5寸机械硬盘。

另外，为了能够营造出服务器的风格，我选择了 `SupTronics X820扩展卡 <http://www.suptronics.com/miniPCkits/x820-hardware.html>`_ 作为机械硬盘转接器。

USB外接SSD移动硬盘
=====================

根据经验和测试 :ref:`wd_passport_ssd` 可以看到通过USB外接SSD移动硬盘是最佳的存储设备，随机4k写入性能是TF卡的46倍。

所以，作为 :ref:`kubernetes` 在ARM设备上部署实现，强烈建议Raspberry Pi采用外接SSD移动硬盘来实现最佳存储性能。

USB外接机械移动硬盘
=====================
