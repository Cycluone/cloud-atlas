<!DOCTYPE html>
<html class="writer-html5" lang="zh-CN" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>独立编译安装screen &mdash; Cloud Atlas 0.1 文档</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/sphinxnotes-strike.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/translations.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="索引" href="../../genindex.html" />
    <link rel="search" title="搜索" href="../../search.html" />
    <link rel="copyright" title="版权所有" href="../../copyright.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> Cloud Atlas
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../studio/index.html">Studio Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infrastructure/index.html">Infrastructure Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../devops/index.html">DevOps Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ansible/index.html">Ansible Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvm/index.html">KVM Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ceph/index.html">Ceph Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gluster/index.html">Gluster Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ovirt/index.html">oVirt Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openstack/index.html">OpenStack Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../docker/index.html">Docker Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kubernetes/index.html">Kubernetes Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../openshift/index.html">OpenShift Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../sql/index.html">SQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mysql/index.html">MySQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../pgsql/index.html">PostgreSQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nosql/index.html">NoSQL Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../redis/index.html">Redis Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/index.html">Network Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../infra_service/index.html">Infra-Service Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../info_service/index.html">Info-Service Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../web/index.html">Web Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../big_data/index.html">Big Data Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../machine_learning/index.html">Machine Learning Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../linux/index.html">Linux Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kernel/index.html">Kernel Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../performance/index.html">Performance Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../distributed_system/index.html">Distributed System Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Shell Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../python/index.html">Python Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../django/index.html">Django Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../javascript/index.html">JavaScript Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../nodejs/index.html">Node.js Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../golang/index.html">Go Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../swift/index.html">Swift Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../rust/index.html">Rust Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../arm/index.html">ARM Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../android/index.html">Android Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../bsd/index.html">BSD Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../apple/index.html">Apple Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../windows/index.html">Windows Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../real/index.html">Real Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../appendix/index.html">附录</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../management/index.html">Management Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../life/index.html">Life Atlas</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../copyright.html">Copyright</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../aboutme.html">关于作者</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../donate.html">捐助</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../thanks.html">感谢</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../roadmap.html">Roadmap</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">Cloud Atlas</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
      <li>独立编译安装<code class="docutils literal notranslate"><span class="pre">screen</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="../../_sources/shell/utils/screen-new.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <p>GNU
Screen是一个终端多路复用管理器，用于同时并发的多路虚拟控制台，允许用在一个登录会话中访问分隔的会话，或者断开并重连一个终端的会话。这样，用户远程登录到服务器，即使关闭终端，也可以再次登录服务器访问上次断开的终端。</p>
<section id="screen">
<h1>独立编译安装<code class="docutils literal notranslate"><span class="pre">screen</span></code><a class="headerlink" href="#screen" title="永久链接至标题">¶</a></h1>
<p>从 <a class="reference external" href="https://www.gnu.org/software/screen/">GNU Screen官网</a>
下载源代码可以自己编译安装最新版本，编译以后生成的<code class="docutils literal notranslate"><span class="pre">screen</span></code>可执行程序可以直接使用。</p>
<p>不过，启动这个自己编译的<code class="docutils literal notranslate"><span class="pre">screen</span></code>显示连接的sockets目录可能和发行版自带的screen所设置的SockDir不同，则可能看不到之前的保持的会话。解决方法参考
<a class="reference external" href="https://superuser.com/questions/445301/how-do-i-reattach-to-a-screen-session-when-the-socket-is-there-but-screen-wont">How do I reattach to a screen session when the socket is there, but
screen won’t use
it?</a>
也就是通过设置 <code class="docutils literal notranslate"><span class="pre">SCREENDIR</span></code> 环境变量来实现</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">export</span> <span class="n">SCREENDIR</span><span class="o">=</span><span class="s2">&quot;/var/run/screen&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p>不过，我遇到升级到screen 4.06 版本无法访问 4.03 的sockets的问题。</p>
</div></blockquote>
</section>
<section id="screentips">
<h1>screen使用tips<a class="headerlink" href="#screentips" title="永久链接至标题">¶</a></h1>
<section id="id1">
<h2>screen窗口<a class="headerlink" href="#id1" title="永久链接至标题">¶</a></h2>
<p>按
<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后在当前窗口中按双引号键（<code class="docutils literal notranslate"><span class="pre">&quot;</span></code>），就可以看到会话中可用窗口的列表</p>
<p>终止当前窗口的方法是，在窗口的 shell 提示上输入
<code class="docutils literal notranslate"><span class="pre">exit</span></code>，或者按键盘快捷键 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按 <code class="docutils literal notranslate"><span class="pre">k</span></code>（小写的字母
<code class="docutils literal notranslate"><span class="pre">K</span></code>，代表
“kill”）。如果使用后一种方法，那么在窗口底部会出现一个警告，要求您确认要杀死此窗口。按
<code class="docutils literal notranslate"><span class="pre">y</span></code>（小写的字母 Y，代表 “yes”）确认，或按 <code class="docutils literal notranslate"><span class="pre">n</span></code>（小写的字母
N，代表 “no”）拒绝。</p>
<ul class="simple">
<li><p>指定窗口名称</p></li>
</ul>
<p>指定窗口名称的方法：激活窗口，按 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">A</span></code>（大写的字母
<code class="docutils literal notranslate"><span class="pre">A</span></code>，代表 “Annotate”），根据需要按 Backspace
删除现有的名称，然后在提示上输入一个有意义的名称</p>
<ul class="simple">
<li><p>修改窗口编号</p></li>
</ul>
<p>由于screen支持<code class="docutils literal notranslate"><span class="pre">0~9</span></code>的10个快捷窗口切换，所以窗口编号非常重要。如果有部分窗口关闭，空出了<code class="docutils literal notranslate"><span class="pre">0~9</span></code>之间的编号，则可以修改其他窗口来填补这个编号。</p>
<p>修改方法：激活窗口，按
<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后输入<code class="docutils literal notranslate"><span class="pre">:number</span> <span class="pre">x</span></code>（<code class="docutils literal notranslate"><span class="pre">x</span></code>就是新窗口编号数字）</p>
<ul class="simple">
<li><p>修改窗口顺序</p></li>
</ul>
<p>如果要重排窗口顺序，按下<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后输入<code class="docutils literal notranslate"><span class="pre">:windowlist</span></code>。此时在显示的窗口列表中，使用<code class="docutils literal notranslate"><span class="pre">.</span></code>将窗口下移，使用<code class="docutils literal notranslate"><span class="pre">,</span></code>将窗口上移。</p>
</section>
<section id="id2">
<h2>screen复制和粘贴<a class="headerlink" href="#id2" title="永久链接至标题">¶</a></h2>
<blockquote>
<div><p>参考 <a class="reference external" href="https://stackoverflow.com/questions/16111548/how-to-copy-the-gnu-screen-copy-buffer-to-the-clipboard">How to copy the GNU Screen copy buffer to the
clipboard?</a></p>
</div></blockquote>
<ul class="simple">
<li><p>进入<code class="docutils literal notranslate"><span class="pre">screen</span></code>的复制模式： <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按下<code class="docutils literal notranslate"><span class="pre">[</span></code></p></li>
<li><p>此时可以通过类似vi的方式进行光标移动</p></li>
<li><p>在需要复制的行，按下<code class="docutils literal notranslate"><span class="pre">space</span></code>空格按键，表示选择。然后再按下<code class="docutils literal notranslate"><span class="pre">j</span></code>或者<code class="docutils literal notranslate"><span class="pre">k</span></code>上下移动光标，复制需要复制的所有行</p></li>
<li><p>再次按下<code class="docutils literal notranslate"><span class="pre">space</span></code>空格按键，结束复制。此时两次<code class="docutils literal notranslate"><span class="pre">space</span></code>按键之间的所有行都被复制到缓存中</p></li>
<li><p>粘贴命令是 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按下<code class="docutils literal notranslate"><span class="pre">]</span></code>，内容复制到当前位置</p></li>
</ul>
</section>
<section id="id3">
<h2>screen配置<a class="headerlink" href="#id3" title="永久链接至标题">¶</a></h2>
<p><strong>可以使用状态栏在视觉上进一步区分各个窗口</strong> :
主目录中创建包含以下代码的 <code class="docutils literal notranslate"><span class="pre">.screenrc</span></code> 文件</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">hardstatus</span> <span class="n">on</span>
<span class="n">hardstatus</span> <span class="n">alwayslastline</span>
<span class="n">hardstatus</span> <span class="n">string</span> <span class="s2">&quot;%{.bW}%-w%{.rW}%n %t%{-}%+w %=%{..G} %H %{..Y} %m/</span><span class="si">%d</span><span class="s2"> %C</span><span class="si">%a</span><span class="s2"> &quot;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.screenrc</span></code>配置案例一(推荐)：</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="nb">source</span> /etc/screenrc
altscreen off
hardstatus none
caption always <span class="s2">&quot;%{= wk}%{wk}%-Lw%{rw} %n+%f %t %{wk}%+Lw %=%c%{= R}%{-}&quot;</span>

shelltitle <span class="s2">&quot;</span>$<span class="s2"> |bash&quot;</span>
defscrollback <span class="m">50000</span>
startup_message off
escape ^aa

termcapinfo xterm<span class="p">|</span>xterms<span class="p">|</span>xs<span class="p">|</span>rxvt ti@:te@ <span class="c1"># scroll bar support</span>
term rxvt <span class="c1"># mouse support</span>

bindkey -k k<span class="p">;</span> screen
bindkey -k F1 prev
bindkey -k F2 next
bindkey -d -k kb stuff ^H
<span class="nb">bind</span> x remove
<span class="nb">bind</span> j <span class="nb">eval</span> <span class="s2">&quot;focus down&quot;</span>
<span class="nb">bind</span> k <span class="nb">eval</span> <span class="s2">&quot;focus up&quot;</span>
<span class="nb">bind</span> s <span class="nb">eval</span> <span class="s2">&quot;split&quot;</span> <span class="s2">&quot;focus down&quot;</span> <span class="s2">&quot;prev&quot;</span>
vbell off
shell -bash
</pre></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">.screenrc</span></code>配置案例二：</p></li>
</ul>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span><span class="c1"># GNU Screen - main configuration file</span>
<span class="c1"># All other .screenrc files will source this file to inherit settings.</span>
<span class="c1"># Author: Christian Wills - cwills.sys@gmail.com</span>

<span class="c1"># Allow bold colors - necessary for some reason</span>
attrcolor b <span class="s2">&quot;.I&quot;</span>

<span class="c1"># Tell screen how to set colors. AB = background, AF=foreground</span>
termcapinfo xterm <span class="s1">&#39;Co#256:AB=\E[48;5;%dm:AF=\E[38;5;%dm&#39;</span>

<span class="c1"># Enables use of shift-PgUp and shift-PgDn</span>
termcapinfo xterm<span class="p">|</span>xterms<span class="p">|</span>xs<span class="p">|</span>rxvt ti@:te@

<span class="c1"># Erase background with current bg color</span>
defbce <span class="s2">&quot;on&quot;</span>

<span class="c1"># Enable 256 color term</span>
term xterm-256color

<span class="c1"># Cache 30000 lines for scroll back</span>
defscrollback <span class="m">30000</span>

<span class="c1"># New mail notification</span>
backtick <span class="m">101</span> <span class="m">30</span> <span class="m">15</span> <span class="nv">$HOME</span>/bin/mailstatus.sh

hardstatus alwayslastline
<span class="c1"># Very nice tabbed colored hardstatus line</span>
hardstatus string <span class="s1">&#39;%{= Kd} %{= Kd}%-w%{= Kr}[%{= KW}%n %t%{= Kr}]%{= Kd}%+w %-= %{KG} %H%{KW}|%{KY}%101`%{KW}|%D %M %d %Y%{= Kc} %C%A%{-}&#39;</span>

<span class="c1"># change command character from ctrl-a to ctrl-b (emacs users may want this)</span>
<span class="c1">#escape ^Bb</span>

<span class="c1"># Hide hardstatus: ctrl-a f</span>
<span class="nb">bind</span> f <span class="nb">eval</span> <span class="s2">&quot;hardstatus ignore&quot;</span>
<span class="c1"># Show hardstatus: ctrl-a F</span>
<span class="nb">bind</span> F <span class="nb">eval</span> <span class="s2">&quot;hardstatus alwayslastline&quot;</span>
</pre></div>
</div>
<blockquote>
<div><p>在 <a class="reference external" href="https://gist.github.com/ChrisWills/1337178">A nice default
screenrc</a>
也有一个类似推荐配置。<a class="reference external" href="https://serverfault.com/questions/3740/what-are-useful-screenrc-settings">What are useful .screenrc
settings?</a>推荐了<a class="reference external" href="http://byobu.org/">byobu</a>(屏风)作为screen或者tmux（默认，如果安装了tmux的话）的wrap工具，提供了非常友好的交互方法。</p>
</div></blockquote>
</section>
</section>
<section id="id4">
<h1>screen快捷键<a class="headerlink" href="#id4" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">?</span></code> 显示所有键绑定信息</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">w</span></code> 显示所有窗口列表</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">C-a</span></code> 切换到之前显示的窗口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">c</span></code> 创建一个新的运行shell的窗口并切换到该窗口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">n</span></code> 切换到下一个窗口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span></code>p 切换到前一个窗口(与C-a n相对)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">0..9</span></code> 切换到窗口0..9</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">a</span></code> 发送 C-a到当前窗口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">d</span></code> 暂时断开screen会话</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">K</span></code> 杀掉当前窗口</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">C-a</span> <span class="pre">[</span></code> 进入拷贝/回滚模式</p></li>
</ul>
<table class="docutils align-default">
<colgroup>
<col style="width: 33%" />
<col style="width: 33%" />
<col style="width: 33%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Key</p></th>
<th class="head"><p>Action</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">c</span></code></p></td>
<td><p>new window</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">n</span></code></p></td>
<td><p>next window</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">p</span></code></p></td>
<td><p>previous window</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">&quot;</span></code></p></td>
<td><p>select window from
list</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">Ctrl+a</span></code></p></td>
<td><p>previous window
viewed</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">S</span></code></p></td>
<td><p>split terminal
horizontally into
regions <code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">c</span></code>
to create new window
there</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span></code></p></td>
<td><p>split terminal
vertically into
regions Requires
screen &gt;= 4.1</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">:resize</span></code></p></td>
<td><p>resize region</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">:fit</span></code></p></td>
<td><p>fit screen size to
new terminal size
<code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">F</span></code> is the
same. Do after
resizing xterm</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">:remove</span></code></p></td>
<td><p>remove region
<code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">X</span></code> is the
same</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">tab</span></code></p></td>
<td><p>Move to next region</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">d</span></code></p></td>
<td><p>detach screen from
terminal Start screen
with <code class="docutils literal notranslate"><span class="pre">-r</span></code> option to
reattach</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">A</span></code></p></td>
<td><p>set window title</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">x</span></code></p></td>
<td><p>lock session Enter
user password to
unlock</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">[</span></code></p></td>
<td><p>enter scrollback/copy
mode Enter to start
and end copy region.
<code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">]</span></code> to leave
this mode</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">]</span></code></p></td>
<td><p>paste buffer Supports
pasting between
windows</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">&gt;</span></code></p></td>
<td><p>write paste buffer to
file useful for
copying between
screens</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">&lt;</span></code></p></td>
<td><p>read paste buffer
from file useful for
pasting between
screens</p></td>
<td></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">?</span></code></p></td>
<td><p>show key
bindings/command
names Note unbound
commands only in man
page</p></td>
<td></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">Ctrl+a</span> <span class="pre">:</span></code></p></td>
<td><p>goto screen command
prompt up shows last
command entered</p></td>
<td></td>
</tr>
</tbody>
</table>
<figure class="align-default" id="id7">
<img alt="screen快捷键" src="../img/develop/shell/utilities/Screen-Terminal-Multiplexer-Commands.png" />
<figcaption>
<p><span class="caption-text">screen快捷键</span><a class="headerlink" href="#id7" title="永久链接至图片">¶</a></p>
</figcaption>
</figure>
</section>
<section id="id5">
<h1>screen常用命令<a class="headerlink" href="#id5" title="永久链接至标题">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-t</span> <span class="pre">name</span></code> 命令在创建窗口时指定窗口名称</p>
<p><code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-L</span></code>
命令把每个窗口的输出记录在日志中。每个窗口有自己的日志文件，文件名通常是
<code class="docutils literal notranslate"><span class="pre">~/screenlog.n</span></code>，其中的 <code class="docutils literal notranslate"><span class="pre">n</span></code>
是窗口列表中显示的窗口编号。（这个<code class="docutils literal notranslate"><span class="pre">-L</span></code>参数不需要指定文件名）</p>
<p>最有用的组合键包括：按 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按 <code class="docutils literal notranslate"><span class="pre">0</span></code>（数字零）到 <code class="docutils literal notranslate"><span class="pre">9</span></code>
立即切换到特定的窗口；按 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按 <code class="docutils literal notranslate"><span class="pre">C</span></code>（大写的字母
C，代表 “Clear”）清除一个窗口的内容；按 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按 <code class="docutils literal notranslate"><span class="pre">H</span></code>
启用或禁用日志记录；按 Ctrl-a，然后按 Ctrl-a
在当前窗口和前一个窗口之间来回切换；按 <code class="docutils literal notranslate"><span class="pre">Ctrl-a</span></code>，然后按
<code class="docutils literal notranslate"><span class="pre">Ctrl-\</span></code>（反斜杠）杀死所有窗口并终止当前的 Screen 会话</p>
<p>Screen 会话的连接，可以用 <code class="docutils literal notranslate"><span class="pre">screen</span> <span class="pre">-p</span> <span class="pre">ID</span></code>
命令重新连接特定的窗口，其中的 <code class="docutils literal notranslate"><span class="pre">ID</span></code> 是一个数字或名称</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">screen</span> <span class="o">-</span><span class="n">r</span> <span class="o">-</span><span class="n">p</span> <span class="n">ghost</span>
</pre></div>
</div>
<p><strong>多用户模式连接其它窗口</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">screen</span> <span class="o">-</span><span class="n">x</span> <span class="o">-</span><span class="n">r</span> <span class="n">sharing</span> <span class="o">-</span><span class="n">p</span> <span class="n">one</span>
</pre></div>
</div>
<blockquote>
<div><p>这里 <code class="docutils literal notranslate"><span class="pre">-x</span></code>
表示多用户模式，<code class="docutils literal notranslate"><span class="pre">-p</span> <span class="pre">one</span></code>表示连接到另外一个名字叫<code class="docutils literal notranslate"><span class="pre">one</span></code>的窗口，这样两个窗口就连接在一起，并且可以看到共同的输入输出。</p>
</div></blockquote>
<p><strong>屏幕分隔</strong></p>
<p>左右分割屏幕快捷键是<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">|</span></code>，上下分割屏幕快捷键是<code class="docutils literal notranslate"><span class="pre">Ctro-a</span> <span class="pre">S</span></code></p>
<figure class="align-default" id="id8">
<img alt="screen屏幕分隔" src="img/os/utility/Gnuscreen.png" />
<figcaption>
<p><span class="caption-text">screen屏幕分隔</span><a class="headerlink" href="#id8" title="永久链接至图片">¶</a></p>
</figcaption>
</figure>
<p>去除split出来的<code class="docutils literal notranslate"><span class="pre">region</span></code>使用快捷键<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">X</span></code></p>
<p>分屏以后，可以使用<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">&lt;tab&gt;</span></code>在各个区块间切换，不过，分割屏幕之后，切换到新的屏幕，需要使用<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">c</span></code>来创建会话。</p>
<p><strong>C/P模式和操作</strong></p>
<p>使用快捷键<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">&lt;Esc&gt;</span></code>或者<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">[</span></code>可以进入copy/paste模式，这个模式下可以像在vi中一样移动光标，并可以使用空格键设置标记。其实在这个模式下有很多类似vi的操作，譬如使用/进行搜索，使用y快速标记一行，使用w快速标记一个单词等。关于C/P模式下的高级操作，其文档的这一部分有比较详细的说明。</p>
<p>一般情况下，可以移动光标到指定位置，按下空格设置一个开头标记，然后移动光标到结尾位置，按下空格设置第二个标记，同时会将两个标记之间的部分储存在copy/paste
buffer中，并退出copy/paste模式。在正常模式下，可以使用快捷键<code class="docutils literal notranslate"><span class="pre">Ctrl-a</span> <span class="pre">]</span></code>将储存在buffer中的内容粘贴到当前窗口。</p>
</section>
<section id="sshscreen">
<h1>ssh远程后台在screen中执行脚本<a class="headerlink" href="#sshscreen" title="永久链接至标题">¶</a></h1>
<blockquote>
<div><p>这个功能是screen的杀手锏，提供了远程在后台执行脚本的能力。并且可以随时连接到screen进行维护</p>
</div></blockquote>
<p>参考<a class="reference external" href="http://stackoverflow.com/questions/1628204/how-to-run-a-command-in-background-using-ssh-and-detach-the-session">how to run a command in background using ssh and detach the
session</a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">screen</span> <span class="o">-</span><span class="n">S</span> <span class="n">restart_network</span> <span class="o">-</span><span class="n">dm</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">init</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">network</span> <span class="n">restart</span>
</pre></div>
</div>
<p>这样 <code class="docutils literal notranslate"><span class="pre">-dm</span></code> 命令可以执行shell时断开，以便后续再连接访问。</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>-d<span class="p">|</span>-D <span class="o">[</span>pid.tty.host<span class="o">]</span>
     does not start screen, but detaches the elsewhere running screen session. It has the same  effect  as  typing
     <span class="s2">&quot;C-a  d&quot;</span> from screen’s controlling terminal. -D is the equivalent to the power detach key.  If no session can
     be detached, this option is ignored. In combination with the  -r/-R  option  more  powerful  effects  can  be
     achieved:
 -m   causes screen to ignore the <span class="nv">$STY</span> environment variable.  With  <span class="s2">&quot;screen  -m&quot;</span>  creation  of  a  new  session  is
     enforced, regardless whether screen is called from within another screen session or not. This flag has a spe-
     cial meaning <span class="k">in</span> connection with the ‘-d’ option:
 -d -m   Start screen <span class="k">in</span> <span class="s2">&quot;detached&quot;</span> mode. This creates a new session but doesn’t attach to it. This is  useful  <span class="k">for</span>
 system startup scripts.
</pre></div>
</div>
<blockquote>
<div><p>使用<code class="docutils literal notranslate"><span class="pre">screen</span></code>的好处是某些需要使用tty的工具可以正常执行</p>
<p>注意<code class="docutils literal notranslate"><span class="pre">一定要正常能够执行的shell脚本</span></code>，否则会直接结束，并且返回值还是<code class="docutils literal notranslate"><span class="pre">0</span></code>，就不知道是否正确执行脚本了</p>
</div></blockquote>
<p>使用<code class="docutils literal notranslate"><span class="pre">nohup</span></code>也可以实现</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ssh</span> <span class="n">remoteserver</span> <span class="s1">&#39;nohup /path/to/script `&lt;/dev/null` &gt;nohup.out 2&gt;&amp;1 &amp;&#39;</span>
</pre></div>
</div>
<p>但是nohup方式不利于再次连接终端进行检查。</p>
<p>一个案例：需要在服务器上通过<code class="docutils literal notranslate"><span class="pre">strace</span></code>工具来跟踪程序<code class="docutils literal notranslate"><span class="pre">example_program</span></code></p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>pssh -ih nc_list <span class="s1">&#39;screen -S strace_example_program -d -m sudo strace -o example_program.strace -p `pgrep example_program`&#39;</span>
</pre></div>
</div>
</section>
<section id="cannot-open-your-terminal">
<h1>Cannot open your terminal<a class="headerlink" href="#cannot-open-your-terminal" title="永久链接至标题">¶</a></h1>
<p>当时用sudo切换到普通用户身份执行<code class="docutils literal notranslate"><span class="pre">screen</span></code>指令时，会遇到报错</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>Cannot open your terminal <span class="s1">&#39;/dev/pts/135&#39;</span> - please check.
</pre></div>
</div>
<p>这个报错原因是因为你通过其他用户身份登录到系统终端中，然后执行了<code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">su</span></code>指令，此时<code class="docutils literal notranslate"><span class="pre">tty</span></code>终端设备并没有随着身份切换而改变，所以切换身份后用户无法访问终端设备文件。</p>
<p>用以下方法可以验证：</p>
<ul class="simple">
<li><p>首先登录到系统中，执行<code class="docutils literal notranslate"><span class="pre">tty</span></code>命令可以查看到终端设备名：</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#tty</span>
<span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">pts</span><span class="o">/</span><span class="mi">135</span>
</pre></div>
</div>
<ul class="simple">
<li><p>然后切换身份到<code class="docutils literal notranslate"><span class="pre">admin</span></code>用户再次执行<code class="docutils literal notranslate"><span class="pre">tty</span></code>命令则看到终端设备名不变，依然是<code class="docutils literal notranslate"><span class="pre">/dev/pts/135</span></code></p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>#su - admin
-bash: ulimit: open files: cannot modify limit: Operation not permitted

$tty
/dev/pts/135
</pre></div>
</div>
<p>解决方法有以下几种：</p>
<ul class="simple">
<li><p>退出系统，直接用需要使用<code class="docutils literal notranslate"><span class="pre">screen</span></code>指令的用户身份登录系统，这样使用<code class="docutils literal notranslate"><span class="pre">screen</span></code>命令就不会有无法访问<code class="docutils literal notranslate"><span class="pre">/dev/pts/XXX</span></code>权限问题</p></li>
<li><p>直接修改设备权限，例如<code class="docutils literal notranslate"><span class="pre">chmod</span> <span class="pre">777</span> <span class="pre">/dev/pts/135</span></code>，但是这个方法存在安全隐患，不建议使用</p></li>
<li><p>推荐的解决方法：使用<code class="docutils literal notranslate"><span class="pre">script</span> <span class="pre">/dev/null</span></code>指令，这样用户的<code class="docutils literal notranslate"><span class="pre">tty</span></code>设备就会切换到其他终端设备。</p></li>
</ul>
<p>案例：</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$script /dev/null
Script started, file is /dev/null
bash: ulimit: open files: cannot modify limit: Operation not permitted

$tty
/dev/pts/189
</pre></div>
</div>
<p>此时使用<code class="docutils literal notranslate"><span class="pre">screen</span></code>指令就不会存在权限错误问题。</p>
</section>
<section id="id6">
<h1>参考<a class="headerlink" href="#id6" title="永久链接至标题">¶</a></h1>
<ul class="simple">
<li><p><a class="reference external" href="http://www.ibm.com/developerworks/cn/aix/library/au-gnu_screen/index.html">对话 UNIX: 使用 Screen 创建并管理多个
shell</a></p></li>
<li><p><a class="reference external" href="http://www.cnblogs.com/mchina/archive/2013/01/30/2880680.html">linux screen
命令详解</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/GNU_Screen">WikiPedia: GNU Screen</a></p></li>
<li><p><a class="reference external" href="https://www.ibm.com/developerworks/cn/linux/l-cn-screen/">linux 技巧：使用 screen
管理你的远程会话</a></p></li>
<li><p><a class="reference external" href="http://freecode.com/articles/the-antidesktop">The Antidesktop</a>
一个有趣的桌面替代方案</p></li>
<li><p><a class="reference external" href="http://www.pixelbeat.org/lkdb/screen.html">screen key</a> -
这篇文档常用快捷键</p></li>
<li><p><a class="reference external" href="https://blog.ttionya.com/article-1318.html">解决Screen出现Cannot open your terminal
‘/dev/pts/0’问题</a> 和
<a class="reference external" href="https://makandracards.com/makandra/2533-solve-screen-error-cannot-open-your-terminal-dev-pts-0-please-check">Solve screen error “Cannot open your terminal ‘/dev/pts/0’ - please
check”</a>
提供了解决<code class="docutils literal notranslate"><span class="pre">Cannot</span> <span class="pre">open</span> <span class="pre">your</span> <span class="pre">terminal</span> <span class="pre">'/dev/pts/0'</span></code>报错的方法</p></li>
<li><p><a class="reference external" href="https://tomlee.co/2011/10/gnu-screen-splitting/">GNU Screen
splitting</a></p></li>
<li><p><a class="reference external" href="http://sourcedigit.com/12480-split-terminal-screen-linux-ubuntu-14-04/">How to Split Terminal Screen in Linux Ubuntu
14.04</a>
这篇文章详细介绍了tmux和screen分割屏幕的操作方法，可以参考使用</p></li>
<li><p><a class="reference external" href="https://serverfault.com/questions/244294/how-to-re-order-windows-change-the-scroll-shortcut-and-modify-the-status-bar-c/282279">How to re-order windows, change the scroll shortcut, and modify the
status bar contents in GNU
Screen?</a></p></li>
</ul>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; <a href="../../copyright.html"> 版权所有</a> 2018 - now, Huatai Huang.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
  
    <!-- your html code here -->
    <br>
    <p><a href="https://github.com/huataihuang/cloud-atlas/issues">留言和讨论</a>|<a href="https://github.com/huataihuang/cloud-atlas/blob/master/source/donate.rst">请我喝一杯咖啡</a></p>
     


</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>