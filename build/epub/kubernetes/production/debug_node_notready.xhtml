<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>kubenetes节点”NotReady”状态排查</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="kubenetes-notready">
<span id="debug-node-notready"></span><h1>kubenetes节点”NotReady”状态排查</h1>
<p>在线上维护的Kubenetes的服务器节点(node)，最常见的问题是节点进入 <code class="docutils literal notranslate"><span class="pre">NotReady</span></code> 状态，这种情况是客户端异常，需要检查客户端日志。</p>
<section id="id1">
<h2>排查</h2>
<ul>
<li><p>首先获取node节点报告，使用 <code class="docutils literal notranslate"><span class="pre">describe</span> <span class="pre">nodes</span></code> 可以看到详细信息:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>kubectl --kubeconfig ./biz/${CLUSTER}/admin.kubeconfig.yaml describe node 8183j73kx
</pre></div>
</div>
</li>
</ul>
<p>在 <code class="docutils literal notranslate"><span class="pre">Conditions:</span></code> 段落可以获得初步的判断信息，例如:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Conditions</span><span class="p">:</span>
  <span class="n">Type</span>             <span class="n">Status</span>    <span class="n">LastHeartbeatTime</span>                 <span class="n">LastTransitionTime</span>                <span class="n">Reason</span>              <span class="n">Message</span>
  <span class="o">----</span>             <span class="o">------</span>    <span class="o">-----------------</span>                 <span class="o">------------------</span>                <span class="o">------</span>              <span class="o">-------</span>
  <span class="n">OutOfDisk</span>        <span class="n">Unknown</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">NodeStatusUnknown</span>   <span class="n">Kubelet</span> <span class="n">stopped</span> <span class="n">posting</span> <span class="n">node</span> <span class="n">status</span><span class="o">.</span>
  <span class="n">MemoryPressure</span>   <span class="n">Unknown</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">NodeStatusUnknown</span>   <span class="n">Kubelet</span> <span class="n">stopped</span> <span class="n">posting</span> <span class="n">node</span> <span class="n">status</span><span class="o">.</span>
  <span class="n">DiskPressure</span>     <span class="n">Unknown</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">NodeStatusUnknown</span>   <span class="n">Kubelet</span> <span class="n">stopped</span> <span class="n">posting</span> <span class="n">node</span> <span class="n">status</span><span class="o">.</span>
  <span class="n">PIDPressure</span>      <span class="n">Unknown</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">NodeStatusUnknown</span>   <span class="n">Kubelet</span> <span class="n">stopped</span> <span class="n">posting</span> <span class="n">node</span> <span class="n">status</span><span class="o">.</span>
  <span class="n">Ready</span>            <span class="n">Unknown</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">16</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">Thu</span><span class="p">,</span> <span class="mi">09</span> <span class="n">May</span> <span class="mi">2019</span> <span class="mi">07</span><span class="p">:</span><span class="mi">45</span><span class="p">:</span><span class="mi">00</span> <span class="o">+</span><span class="mi">0800</span>   <span class="n">NodeStatusUnknown</span>   <span class="n">Kubelet</span> <span class="n">stopped</span> <span class="n">posting</span> <span class="n">node</span> <span class="n">status</span><span class="o">.</span>
</pre></div>
</div>
<ul>
<li><p>对于客户端 <code class="docutils literal notranslate"><span class="pre">Kubelet</span></code> 报错，如果可以登陆到客户机，则检查日志。需要注意日志是否通过 <code class="docutils literal notranslate"><span class="pre">systemd</span></code> 服务，如果是通过 journal 记录日志，则通过以下命令检查:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">journalctl</span> <span class="o">-</span><span class="n">u</span> <span class="n">kubelet</span>
</pre></div>
</div>
</li>
</ul>
<p>如果使用 syslog ，则直接检查服务日志。</p>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://stackoverflow.com/questions/47107117/how-to-debug-when-kubernetes-nodes-are-in-not-ready-state">How to debug when Kubernetes nodes are in ‘Not Ready’ state</a><span class="link-target"> [https://stackoverflow.com/questions/47107117/how-to-debug-when-kubernetes-nodes-are-in-not-ready-state]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>