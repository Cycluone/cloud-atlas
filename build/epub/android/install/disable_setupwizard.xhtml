<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>禁用Android初始化设置Wizard</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="androidwizard">
<span id="disable-setupwizard"></span><h1>禁用Android初始化设置Wizard</h1>
<p>在 <a class="reference internal" href="android_10_pixel_xl.xhtml#android-10-pixel-xl"><span class="std std-ref">在Pixel XL(marlin)上安装Android 10</span></a> 后，由于原生Android默认安装了GMS，开机启动第一次初始化会强制要求连接到Google服务进行账号注册。这带来了一个死循环：</p>
<ul class="simple">
<li><p>在墙内系统无法直接访问Google</p></li>
<li><p>没有完成初始化无法跳过进入系统，也就无法使用 <a class="reference internal" href="../../linux/security/vpn/openconnect_vpn.xhtml#openconnect-vpn"><span class="std std-ref">OpenConnect VPN</span></a> 来访问Google</p></li>
</ul>
<p>总之，没有Google无法激活，原先我记得连接局域网注册失败，再尝试一次通过移动网络注册失败，Andorid的Setup Wizard是会提供一个选项允许暂时跳过设置。但是，最近一次刷新Factory Image，却发现这个跳过选项没有了。这就导致无法进入Android系统使用手机。</p>
<p>解决思路：</p>
<ul>
<li><p>参考 <a class="reference internal" href="../startup/root_pixel.xhtml#root-pixel"><span class="std std-ref">Root Pixel设备</span></a> ，使用TWRP的IMG文件进入系统，mount选项挂载上system</p></li>
<li><p>修改 <code class="docutils literal notranslate"><span class="pre">/system/build.prop</span></code> 参数，添加一行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ro</span><span class="o">.</span><span class="n">setupwizard</span><span class="o">.</span><span class="n">mode</span><span class="o">=</span><span class="n">DISABLED</span>
</pre></div>
</div>
</li>
</ul>
<p>然后再次启动系统就会跳过Wizard，这样就可以再安装openconnect来连接Google，就可以重新注册了。</p>
<section id="id1">
<h2>步骤</h2>
<ul>
<li><p>重启手机操作系统，重启同时按住 <code class="docutils literal notranslate"><span class="pre">音量减小键</span></code> ，这样重启后进入fastboot模式</p></li>
<li><p>下载 <a class="reference external" href="https://dl.twrp.me/marlin/twrp-3.3.1-3-marlin.img.html">twrp-3.3.1-3-marlin.img</a><span class="link-target"> [https://dl.twrp.me/marlin/twrp-3.3.1-3-marlin.img.html]</span> 在电脑上执行以下命令以便从TWRP img启动:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fastboot</span> <span class="n">boot</span> <span class="n">twrp</span><span class="o">-</span><span class="mf">3.3</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="n">marlin</span><span class="o">.</span><span class="n">img</span>
</pre></div>
</div>
</li>
<li><p>启动TWRP之后，在界面上选择 <code class="docutils literal notranslate"><span class="pre">mount</span></code> 挂载system，不过只能选择readonly，挂载后在电脑上执行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">shell</span>
</pre></div>
</div>
</li>
</ul>
<p>进入系统检查:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">-</span><span class="n">h</span>
</pre></div>
</div>
<p>可以看到:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">block</span><span class="o">/</span><span class="n">sda33</span> <span class="mf">1.9</span><span class="n">G</span>  <span class="mf">1.9</span><span class="n">G</span>   <span class="mi">47</span><span class="n">M</span>  <span class="mi">98</span><span class="o">%</span> <span class="o">/</span><span class="n">system</span>
</pre></div>
</div>
<p>重试重新挂载成读写模式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="o">-</span><span class="n">o</span> <span class="n">remount</span><span class="p">,</span><span class="n">rw</span> <span class="o">/</span><span class="n">system</span>
</pre></div>
</div>
<p>但是报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">linker</span><span class="p">:</span> <span class="ne">Warning</span><span class="p">:</span> <span class="n">couldn</span><span class="s1">&#39;t read &quot;/system/etc/ld.config.txt&quot; for &quot;/sbin/toybox&quot; (using default configuration instead): error reading file &quot;/system/etc/ld.config.txt&quot;: Too many symbolic links encountered</span>
<span class="n">WARNING</span><span class="p">:</span> <span class="n">linker</span><span class="p">:</span> <span class="ne">Warning</span><span class="p">:</span> <span class="n">couldn</span><span class="s1">&#39;t read &quot;/system/etc/ld.config.txt&quot; for &quot;/sbin/toybox&quot; (using default configuration instead): error reading file &quot;/system/etc/ld.config.txt&quot;: Too many symbolic links encountered</span>
<span class="s1">&#39;/dev/block/bootdevice/by-name/system_a&#39;</span> <span class="ow">is</span> <span class="n">read</span><span class="o">-</span><span class="n">only</span>
</pre></div>
</div>
<p>这里比较奇怪，参考 <a class="reference external" href="https://stackoverflow.com/questions/28009716/how-can-i-remount-my-android-system-as-read-write-in-a-bash-script-using-adb">How can I remount my Android/system as read-write in a bash script using adb?
Ask Question</a><span class="link-target"> [https://stackoverflow.com/questions/28009716/how-can-i-remount-my-android-system-as-read-write-in-a-bash-script-using-adb]</span> 通常需要使用root身份来执行adb mount，不过我检查了:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">root</span>
</pre></div>
</div>
<p>显示输出:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adbd</span> <span class="ow">is</span> <span class="n">already</span> <span class="n">running</span> <span class="k">as</span> <span class="n">root</span>
</pre></div>
</div>
<p>这个问题有待进一步探索，目前主要困难在于 <code class="docutils literal notranslate"><span class="pre">-o</span> <span class="pre">remount,rw</span></code> 无法挂载Pixel的系统目录。</p>
<p><a class="reference external" href="http://blogs.unbolt.net/index.php/brinley/2017/04/22/skipping-setup-wizard-on-first-boot">Skipping Setup Wizard on first boot of LineageOS or any Android ROM</a><span class="link-target"> [http://blogs.unbolt.net/index.php/brinley/2017/04/22/skipping-setup-wizard-on-first-boot]</span> 介绍了几种跳过Setup Wizard</p>
</section>
<section id="gms">
<h2>剔除GMS</h2>
<p>实际上有一个非常简单的禁止Google SetupWizard的方法，就是使用第三方编译的Android系统，例如LineageOS。第三方编译的Android系统不包含Andrid Google Mobile Services(GMS)，所以就不会启动默认强制连接注册Google服务。</p>
<p>ZEBRA开发网站提供了一系列 <a class="reference external" href="https://developer.zebra.com/blog/android-setup-wizard-and-how-bypass-it">The Android Setup Wizard and How to Bypass It</a><span class="link-target"> [https://developer.zebra.com/blog/android-setup-wizard-and-how-bypass-it]</span> ，通过企业管理Android可以绕过Setup Wizard。</p>
<p>如果实在不能跳过Andorid SetupWizard，可以尝试使用LineageOS来替代:</p>
<ul class="simple">
<li><p>LineageOS 16.0 = Android 9.0.0 (Pie)</p></li>
<li><p>LineageOS 17.0/17.1 = Android 10  这个版本非LineageOS官方发布版</p></li>
</ul>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.jianshu.com/p/ffd18cf54b02">android 7.12修改build.prop跳过开机验证</a><span class="link-target"> [https://www.jianshu.com/p/ffd18cf54b02]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>