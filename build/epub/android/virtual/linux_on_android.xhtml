<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>在Android中运行Linux</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="androidlinux">
<span id="linux-on-android"></span><h1>在Android中运行Linux</h1>
<p>Android是一个基于Linux开发的手机操作系统，既然Linux通过 <a class="reference internal" href="../../docker/index.xhtml#docker"><span class="std std-ref">Docker Atlas</span></a> 这样的容器化方式来运行不同的操作系统，Android当然也能采用相似的方式来部署Linux系统。实现的原理就是在Android中通过 <a class="reference internal" href="../../linux/security/chroot.xhtml#chroot"><span class="std std-ref">chroot</span></a> 来切换到一个独立的Linux文件系统，然后运行一个 jail 的Linux系统。</p>
<section id="linux">
<h2>部署Linux</h2>
<ul class="simple">
<li><p>安装 <a class="reference internal" href="../hack/android_busybox.xhtml#android-busybox"><span class="std std-ref">Android系统Busybox</span></a></p></li>
</ul>
<p>Linux Deploy将完整的Linux操作系统放到Android中，这是因为这个应用使用了一些Linux兼容的工具，通常需要 <a class="reference internal" href="../hack/android_busybox.xhtml#android-busybox"><span class="std std-ref">Android系统Busybox</span></a> toolkit。这个busybox应用只需要简单从Google Play安装就可以。</p>
<ul class="simple">
<li><p><a class="reference internal" href="../startup/root_pixel.xhtml#root-pixel"><span class="std std-ref">Root Pixel设备</span></a> - 手机需要rooted，这样可以授权busybox和deploy linux能够使用root权限</p></li>
<li><p>安装 <a class="reference internal" href="../hack/android_busybox.xhtml#android-busybox"><span class="std std-ref">Android系统Busybox</span></a> ，安装Linux之前需要做配置以适应发行版需求</p></li>
<li><p>安装 vnc，以便能够图形化访问Linux系统 - <a class="reference external" href="https://play.google.com/store/apps/details?id=com.realvnc.viewer.android&amp;hl=en">VNC Viewer</a><span class="link-target"> [https://play.google.com/store/apps/details?id=com.realvnc.viewer.android&amp;hl=en]</span></p></li>
<li><p>从Google Play中安装 <code class="docutils literal notranslate"><span class="pre">deploy</span> <span class="pre">Linux</span></code> - 这个工具可以部署不同的Linux发行版</p></li>
</ul>
</section>
<section id="deploy-linux">
<h2>配置Deploy Linux</h2>
<p>在Deploy Linux之前，有以下选项可以配置(请点击右下角的配置按钮):</p>
<ul class="simple">
<li></li>
</ul>
</section>
<section id="id1">
<h2>Deploy Linux账号密码重置</h2>
<p>我遇到一个问题是安装部署了 <a class="reference internal" href="../../linux/alpine_linux/index.xhtml#alpine-linux"><span class="std std-ref">Alpine Linux</span></a> 之后，启动后ssh发现账号密码不正确(虽然我在config的时候指定了账号密码)，所以通过挂载 img 文件，进入该Linux系统重置密码:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">adb</span> <span class="n">shell</span>
<span class="n">su</span>
<span class="n">cd</span> <span class="o">/</span><span class="n">sccard</span>
<span class="n">mkdir</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span>
<span class="n">mount</span> <span class="o">-</span><span class="n">t</span> <span class="n">ext4</span> <span class="o">-</span><span class="n">o</span> <span class="n">loop</span> <span class="n">alpine</span><span class="o">.</span><span class="n">img</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span>

<span class="n">mount</span> <span class="o">-</span><span class="n">t</span> <span class="n">proc</span> <span class="n">proc</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span><span class="o">/</span><span class="n">proc</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">rebind</span> <span class="o">/</span><span class="n">sys</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span><span class="o">/</span><span class="n">sys</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">rslave</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span><span class="o">/</span><span class="n">sys</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">rbind</span> <span class="o">/</span><span class="n">dev</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span><span class="o">/</span><span class="n">dev</span>
<span class="n">mount</span> <span class="o">--</span><span class="n">make</span><span class="o">-</span><span class="n">rslave</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span><span class="o">/</span><span class="n">dev</span>

<span class="n">chroot</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">alpine</span> <span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">sh</span>
<span class="n">source</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">profile</span>
<span class="n">export</span> <span class="n">PS1</span><span class="o">=</span><span class="s2">&quot;(chroot) $PS1&quot;</span>

<span class="c1"># alpine实际已经有一个GID为20的group：dialout</span>
<span class="n">addgroup</span> <span class="o">-</span><span class="n">g</span> <span class="mi">20</span> <span class="n">staff</span>
<span class="c1"># adduser 提供了设置用户密码</span>
<span class="n">adduser</span> <span class="o">-</span><span class="n">G</span> <span class="n">staff</span> <span class="o">-</span><span class="n">u</span> <span class="mi">501</span> <span class="o">-</span><span class="n">h</span> <span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">huatai</span> <span class="n">huatai</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>通过chroot方式进入系统目录切换操作系统方法，参考 <a class="reference internal" href="../../linux/gentoo_linux/install_gentoo_on_mbp.xhtml#install-gentoo-on-mbp"><span class="std std-ref">在MacBook Pro上安装Gentoo Linux</span></a></p>
<p>我首次使用 <code class="docutils literal notranslate"><span class="pre">mount</span> <span class="pre">-t</span> <span class="pre">ext4</span> <span class="pre">-o</span> <span class="pre">loop</span> <span class="pre">alpine.img</span> <span class="pre">/mnt/alpine</span></code> 成功，但是重启过Android再次执行有报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span><span class="p">:</span> <span class="s1">&#39;/dev/block/loop0&#39;</span><span class="o">-&gt;</span><span class="s1">&#39;/mnt/alpine&#39;</span><span class="p">:</span> <span class="n">Block</span> <span class="n">device</span> <span class="n">required</span>
</pre></div>
</div>
<p>adduser`` 添加的用户shell是 <code class="docutils literal notranslate"><span class="pre">/system/bin/sh</span></code> 实际是android系统的shell，需要修改成alpine的 <code class="docutils literal notranslate"><span class="pre">/bin/sh</span></code> 。</p>
</div>
<p>不过，上述账号错误可能和执行安装时网络异常有关。我在较好的网络环境下再次验证安装，则非常顺利完成账号初始化。</p>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.addictivetips.com/ubuntu-linux-tips/run-linux-in-android-with-linux-deploy/">How To Run Linux On Android With Linux Deploy</a><span class="link-target"> [https://www.addictivetips.com/ubuntu-linux-tips/run-linux-in-android-with-linux-deploy/]</span></p></li>
<li><p><a class="reference external" href="https://www.maketecheasier.com/install-ubuntu-on-android-linux-deploy/">How to Install Ubuntu on Your Android Phone Using Linux Deploy</a><span class="link-target"> [https://www.maketecheasier.com/install-ubuntu-on-android-linux-deploy/]</span></p></li>
<li></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>