<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>CentOS本地软件仓库</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="centos">
<span id="centos-local-repo"></span><h1>CentOS本地软件仓库</h1>
<p>当一次次通过Internet安装和更新CentOS，当运维当服务器越来越多，你一定会有一个强烈的愿望，构建一个本地CentOS软件仓库。这样只要同步一次集中的软件仓库，就可以提供本地局域网所有CentOS服务器更新到相同版本。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>本实践是在CentOS 8上完成，使用安装命令是 <code class="docutils literal notranslate"><span class="pre">dnf</span></code> ，如果你使用CentOS 7或更低版本，则使用 <code class="docutils literal notranslate"><span class="pre">yum</span></code> 代替 <code class="docutils literal notranslate"><span class="pre">dnf</span></code> 命令。</p>
</div>
<p>CentOS 8包含2个仓库: <code class="docutils literal notranslate"><span class="pre">BaseOS</span></code> 和 <code class="docutils literal notranslate"><span class="pre">AppStream</span></code> (Application Stream):</p>
<ul class="simple">
<li><p>BaseOS是最小化操作系统所需要的软件包</p></li>
<li><p>AppStream则包含其余软件包，依赖和数据库</p></li>
</ul>
<p>如果你手边有CentOS 8 DVD安装ISO文件，则可以使用安装光盘的ISO文件快速构建本地安装仓库，方便进行软件安装。</p>
<section id="centos-8iso">
<h2>挂载CentOS 8安装ISO文件</h2>
<ul>
<li><p>挂载ISO文件到选定的目录，这里选择 <code class="docutils literal notranslate"><span class="pre">/opt</span></code> 目录:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mount</span> <span class="n">CentOS</span><span class="o">-</span><span class="mi">8</span><span class="o">-</span><span class="n">x86_64</span><span class="o">-</span><span class="mi">1905</span><span class="o">-</span><span class="n">dvd1</span><span class="o">.</span><span class="n">iso</span> <span class="o">/</span><span class="n">opt</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="centosyum">
<h2>创建CentOS本地YUM仓库</h2>
<ul>
<li><p>在ISO文件挂载的目录下有一个 <code class="docutils literal notranslate"><span class="pre">media.repo</span></code> 文件，复制到 <code class="docutils literal notranslate"><span class="pre">/etc/yum.repos.d/</span></code> 目录下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cp</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">media</span><span class="o">.</span><span class="n">repo</span>  <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">centos8</span><span class="o">.</span><span class="n">repo</span>
</pre></div>
</div>
</li>
<li><p>修订该文件属性避免被其他用户修改:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">chmod</span> <span class="mi">644</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">yum</span><span class="o">.</span><span class="n">repos</span><span class="o">.</span><span class="n">d</span><span class="o">/</span><span class="n">centos8</span><span class="o">.</span><span class="n">repo</span>
</pre></div>
</div>
</li>
<li><p>修改该配置文件内容修改如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">[</span><span class="n">InstallMedia</span><span class="o">-</span><span class="n">BaseOS</span><span class="p">]</span>
<span class="n">name</span><span class="o">=</span><span class="n">CentOS</span> <span class="n">Linux</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">BaseOS</span>
<span class="n">metadata_expire</span><span class="o">=-</span><span class="mi">1</span>
<span class="n">gpgcheck</span><span class="o">=</span><span class="mi">1</span>
<span class="n">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="n">baseurl</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">opt</span><span class="o">/</span><span class="n">BaseOS</span><span class="o">/</span>
<span class="n">gpgkey</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">centosofficial</span>

<span class="p">[</span><span class="n">InstallMedia</span><span class="o">-</span><span class="n">AppStream</span><span class="p">]</span>
<span class="n">name</span><span class="o">=</span><span class="n">CentOS</span> <span class="n">Linux</span> <span class="mi">8</span> <span class="o">-</span> <span class="n">AppStream</span>
<span class="n">metadata_expire</span><span class="o">=-</span><span class="mi">1</span>
<span class="n">gpgcheck</span><span class="o">=</span><span class="mi">1</span>
<span class="n">enabled</span><span class="o">=</span><span class="mi">1</span>
<span class="n">baseurl</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">opt</span><span class="o">/</span><span class="n">AppStream</span><span class="o">/</span>
<span class="n">gpgkey</span><span class="o">=</span><span class="n">file</span><span class="p">:</span><span class="o">///</span><span class="n">etc</span><span class="o">/</span><span class="n">pki</span><span class="o">/</span><span class="n">rpm</span><span class="o">-</span><span class="n">gpg</span><span class="o">/</span><span class="n">RPM</span><span class="o">-</span><span class="n">GPG</span><span class="o">-</span><span class="n">KEY</span><span class="o">-</span><span class="n">centosofficial</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id1">
<h2>使用本地仓库</h2>
<ul>
<li><p>现在更新DNF/YUM缓存:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">clean</span> <span class="nb">all</span>
<span class="c1"># 或者</span>
<span class="n">yum</span> <span class="n">clean</span> <span class="nb">all</span>
</pre></div>
</div>
</li>
<li><p>检查本地软件仓库是否生效:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">repolist</span>
<span class="c1"># 或者</span>
<span class="n">yum</span> <span class="n">repolist</span>
</pre></div>
</div>
</li>
<li><p>现在就可以安装软件包了，可以看到软件包是本地仓库:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dnf</span> <span class="n">install</span> <span class="o">&lt;</span><span class="n">package_name</span><span class="o">&gt;</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.tecmint.com/create-local-yum-repository-on-centos-8/">How to Set Up a Local Yum/DNF Repository on CentOS 8</a><span class="link-target"> [https://www.tecmint.com/create-local-yum-repository-on-centos-8/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>