<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>systemd禁止笔记本suspend</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="systemdsuspend">
<span id="systemd-dissuspend"></span><h1>systemd禁止笔记本suspend</h1>
<p>我在 <a class="reference internal" href="../../ubuntu_linux/ubuntu_server.xhtml#ubuntu-server"><span class="std std-ref">Ubuntu Server</span></a> 和 <a class="reference internal" href="../../ubuntu_linux/ubuntu_on_mbp.xhtml#ubuntu-on-mbp"><span class="std std-ref">MacBook Pro上运行Ubuntu</span></a> 实践中，都是采用笔记本电脑作为服务器运行。但是笔记本默认情况下，合上屏幕就会休眠 ，而作为服务器希望使用运行，在屏幕关闭的时候不出现suspend，否则会导致主机网路断开无法访问。</p>
<section id="suspend">
<h2>禁用屏幕关闭时suspend</h2>
<ul>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/etc/systemd/logind.conf</span></code> 配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1">#HandleLidSwitch=suspend</span>
<span class="n">HandleLidSwitch</span><span class="o">=</span><span class="n">ignore</span>
<span class="c1">#HandleLidSwitchExternalPower=suspend</span>
<span class="n">HandleLidSwitchExternalPower</span><span class="o">=</span><span class="n">ignore</span>
<span class="c1">#HandleLidSwitchDocked=ignore #这行设置是默认的</span>
</pre></div>
</div>
</li>
<li><p>然后重新加载 <code class="docutils literal notranslate"><span class="pre">logind.conf</span></code> 配置以便生效:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">systemctl</span> <span class="n">restart</span> <span class="n">systemd</span><span class="o">-</span><span class="n">logind</span>
</pre></div>
</div>
</li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">logind.conf</span></code> 的man中有如下相关信息：</p></li>
</ul>
<p><code class="docutils literal notranslate"><span class="pre">HandlePowerKey=,</span> <span class="pre">HandleSuspendKey=,</span> <span class="pre">HandleHibernateKey=,</span> <span class="pre">HandleLidSwitch=</span></code>  控制了logind如何处理系统电源管理和睡眠键以及屏幕开阖时候触发的动作，例如系统电源关闭或者suspend。设置值可以是 <code class="docutils literal notranslate"><span class="pre">ignore</span></code> ， <code class="docutils literal notranslate"><span class="pre">poweroff</span></code> ， <code class="docutils literal notranslate"><span class="pre">reboot</span></code> ， <code class="docutils literal notranslate"><span class="pre">halt</span></code> ， <code class="docutils literal notranslate"><span class="pre">kexec</span></code> ， <code class="docutils literal notranslate"><span class="pre">suspend</span></code> ， <code class="docutils literal notranslate"><span class="pre">hybrid-sleep</span></code> 和  <code class="docutils literal notranslate"><span class="pre">lock</span></code> 。如果设置了 <code class="docutils literal notranslate"><span class="pre">ignore</span></code> ，就不会处理任何这些键。如果设置 <code class="docutils literal notranslate"><span class="pre">lock</span></code> 则会锁定屏幕。只有输入设备具有 <code class="docutils literal notranslate"><span class="pre">power-switch</span></code> udev标签才会监视键盘和屏幕开阖事件。默认设置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">HandlePowerKey</span><span class="o">=</span><span class="n">poweroff</span>
<span class="n">HandleSuspendKey</span><span class="o">=</span><span class="n">suspend</span>
<span class="n">HandleLidSwitch</span><span class="o">=</span><span class="n">suspend</span>
<span class="n">HandleHibernateKey</span><span class="o">=</span><span class="n">hibernate</span>
</pre></div>
</div>
<p>对于外接屏幕的笔记本，合上屏幕以后，还可以设置屏幕关闭，这样可以进一步减少能源消耗，也降低笔记本温度。方法是使用 <code class="docutils literal notranslate"><span class="pre">vbetool</span></code> 工具:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">vbetool</span> <span class="n">dpms</span> <span class="n">off</span>
</pre></div>
</div>
<p>建议采用如下方法，这样即使关闭屏幕，只要按下 <code class="docutils literal notranslate"><span class="pre">Enter</span></code> 键就可以恢复:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">sh</span> <span class="o">-</span><span class="n">c</span> <span class="s1">&#39;vbetool dpms off; read ans; vbetool dpms on&#39;</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>X图形界面下关闭屏幕使用 <code class="docutils literal notranslate"><span class="pre">xset</span></code> 工具实现，可以参考 <a class="reference external" href="https://github.com/huataihuang/cloud-atlas-draft/blob/master/os/linux/redhat/system_administration/systemd/disable_screen_on_lid_close.md">合上笔记本屏幕时关闭屏幕</a><span class="link-target"> [https://github.com/huataihuang/cloud-atlas-draft/blob/master/os/linux/redhat/system_administration/systemd/disable_screen_on_lid_close.md]</span> 的实践记录。</p>
</div>
<p># 参考</p>
<ul class="simple">
<li><p><a class="reference external" href="https://unix.stackexchange.com/questions/52643/how-to-disable-auto-suspend-when-i-close-laptop-lid">How to disable auto suspend when I close laptop lid?</a><span class="link-target"> [https://unix.stackexchange.com/questions/52643/how-to-disable-auto-suspend-when-i-close-laptop-lid]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>