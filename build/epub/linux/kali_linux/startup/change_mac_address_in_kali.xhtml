<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Kali Linux伪装MAC地址</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="kali-linuxmac">
<span id="change-mac-address-in-kali"></span><h1>Kali Linux伪装MAC地址</h1>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>在局域网中通过限制MAC地址方式来限制网络访问，实际效果会非常差，因为很多时候操作系统可以修改MAC地址，导致安全策略无效。</p>
</div>
<p>通过修改网卡的MAC地址可以使得Kali Linux在做hack活动之前避免被反向跟踪。</p>
<p>在修改任何网络设备前需要确保已经关闭（down）了设备，然后再运行修改MAC地址的命令。</p>
<section id="mac">
<h2>修改有线网卡MAC地址</h2>
<ul>
<li><p>如果需要修改 <code class="docutils literal notranslate"><span class="pre">eth0</span></code> 网卡的MAC地址，需要关闭网卡:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">eth0</span> <span class="n">down</span>
</pre></div>
</div>
</li>
<li><p>确保该网卡设备停止，然后再修改网卡:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">eth0</span> <span class="n">hw</span> <span class="n">ether</span> <span class="mi">00</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">55</span>
</pre></div>
</div>
</li>
<li><p>然后再次UP起网卡接口，确认MAC地址已经修改成对应的MAC:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">eth0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="id1">
<h2>修改无线网卡MAC地址</h2>
<p>如果要修改无线网卡的MAC地址，则基于使用的不同无线网卡，可能需要采用不同方式。</p>
<ul>
<li><p>首先检查无线网卡:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">iwconfig</span>
</pre></div>
</div>
</li>
</ul>
<p>输出显示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wlan0</span>     <span class="n">IEEE</span> <span class="mf">802.11</span><span class="n">bgn</span>  <span class="n">ESSID</span><span class="p">:</span><span class="n">off</span><span class="o">/</span><span class="nb">any</span>
          <span class="n">Mode</span><span class="p">:</span><span class="n">Managed</span>  <span class="n">Access</span> <span class="n">Point</span><span class="p">:</span> <span class="n">Not</span><span class="o">-</span><span class="n">Associated</span>   <span class="n">Tx</span><span class="o">-</span><span class="n">Power</span><span class="o">=</span><span class="mi">31</span> <span class="n">dBm</span>
          <span class="n">Retry</span> <span class="n">short</span> <span class="n">limit</span><span class="p">:</span><span class="mi">7</span>   <span class="n">RTS</span> <span class="n">thr</span><span class="p">:</span><span class="n">off</span>   <span class="n">Fragment</span> <span class="n">thr</span><span class="p">:</span><span class="n">off</span>
          <span class="n">Encryption</span> <span class="n">key</span><span class="p">:</span><span class="n">off</span>
          <span class="n">Power</span> <span class="n">Management</span><span class="p">:</span><span class="n">on</span>
</pre></div>
</div>
<ul>
<li><p>关闭该无线网卡接口:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">wlan0</span> <span class="n">down</span>
</pre></div>
</div>
</li>
<li><p>然后再使用 <code class="docutils literal notranslate"><span class="pre">iwconfig</span></code> 检查无线网卡接口可以看到(Tx-Power已经去除):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">wlan0</span>     <span class="n">IEEE</span> <span class="mf">802.11</span><span class="n">bgn</span>  <span class="n">ESSID</span><span class="p">:</span><span class="n">off</span><span class="o">/</span><span class="nb">any</span>
          <span class="n">Mode</span><span class="p">:</span><span class="n">Managed</span>  <span class="n">Access</span> <span class="n">Point</span><span class="p">:</span> <span class="n">Not</span><span class="o">-</span><span class="n">Associated</span>
          <span class="n">Retry</span> <span class="n">short</span> <span class="n">limit</span><span class="p">:</span><span class="mi">7</span>   <span class="n">RTS</span> <span class="n">thr</span><span class="p">:</span><span class="n">off</span>   <span class="n">Fragment</span> <span class="n">thr</span><span class="p">:</span><span class="n">off</span>
          <span class="n">Encryption</span> <span class="n">key</span><span class="p">:</span><span class="n">off</span>
          <span class="n">Power</span> <span class="n">Management</span><span class="p">:</span><span class="n">on</span>
</pre></div>
</div>
</li>
<li><p>使用 <code class="docutils literal notranslate"><span class="pre">macchanger</span></code> 工具修改无线网卡的MAC地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">macchanger</span> <span class="o">-</span><span class="n">m</span> <span class="mi">00</span><span class="p">:</span><span class="mi">11</span><span class="p">:</span><span class="mi">22</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">44</span><span class="p">:</span><span class="mi">55</span> <span class="n">wlan0</span>
</pre></div>
</div>
</li>
<li><p>然后启动无线网卡，检查网卡的MAC地址:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ifconfig</span> <span class="n">wlan0</span> <span class="n">up</span>
</pre></div>
</div>
</li>
<li><p>要确保每次系统启动都能够正确修改MAC地址，需要在网卡配置文件 <code class="docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> <code class="docutils literal notranslate"><span class="pre">最后</span></code> 添加如下内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pre</span><span class="o">-</span><span class="n">up</span> <span class="n">ifconfig</span> <span class="n">eth0</span> <span class="n">hw</span> <span class="n">ether</span> <span class="mi">00</span><span class="p">:</span><span class="mi">33</span><span class="p">:</span><span class="mi">55</span><span class="p">:</span><span class="mi">77</span><span class="p">:</span><span class="mi">99</span><span class="p">:</span><span class="mi">00</span>
</pre></div>
</div>
</li>
<li><p>然后重启网络服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">service</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span> <span class="n">restart</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="ubuntu-macchanger">
<h2>ubuntu macchanger</h2>
<p>在Ubuntu中，安装macchanger，则会提示</p>
<figure class="align-default">
<img alt="../../../_images/ubuntu_macchanger.png" src="../../../_images/ubuntu_macchanger.png" style="width: 600.0px; height: 230.25px;" />
</figure>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>实际上系统修改MAC地址有很多种方法，在 <a class="reference external" href="https://wiki.archlinux.org/index.php/MAC_address_spoofing">arch linux官方文档-MAC address spoofing</a><span class="link-target"> [https://wiki.archlinux.org/index.php/MAC_address_spoofing]</span> 提供了不同的方案。使用的工具有两种 <code class="docutils literal notranslate"><span class="pre">iproute2</span></code> 和 <code class="docutils literal notranslate"><span class="pre">macchanger</span></code> ，不过自动化设置则结合了systemd-networkd，systemd-udevd, systemd unit以及netctl hook等方法。</p>
</div>
<section id="systemd-udevd">
<h3>systemd-udevd</h3>
<p>udev可以通过udev rules来执行MAC地址修订，使用 <code class="docutils literal notranslate"><span class="pre">address</span></code> 属性匹配的设备可以使用ip命令修改MAC地址。</p>
<ul>
<li><p>创建 <code class="docutils literal notranslate"><span class="pre">/etc/udev/rules.d/75-mac-spoof.rules</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ACTION</span><span class="o">==</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="n">SUBSYSTEM</span><span class="o">==</span><span class="s2">&quot;net&quot;</span><span class="p">,</span> <span class="n">ATTR</span><span class="p">{</span><span class="n">address</span><span class="p">}</span><span class="o">==</span><span class="s2">&quot;XX:XX:XX:XX:XX:XX&quot;</span><span class="p">,</span> <span class="n">RUN</span><span class="o">+=</span><span class="s2">&quot;/usr/bin/ip link set dev $name address YY:YY:YY:YY:YY:YY&quot;</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="netplanmac-spoof">
<h2>netplan实现mac spoof</h2>
<p>现代的Ubuntu发行版采用了 <a class="reference internal" href="../../ubuntu_linux/network/netplan.xhtml#netplan"><span class="std std-ref">netplan网络配置</span></a> 来配置网络，这个netplan工具后端实现是通过 systemd 的 networkd 或者 NetworkManager 来实现的，同样支持 <a class="reference internal" href="../../ubuntu_linux/network/netplan.xhtml#netplan-mac-spoof"><span class="std std-ref">netplan mac spoof</span></a> 。</p>
</section>
<section id="networkmanagermac-spoof">
<h2>NetworkManager实现mac spoof</h2>
<p><a class="reference internal" href="../../ubuntu_linux/network/networkmanager.xhtml#networkmanager"><span class="std std-ref">NetworkManager</span></a> 也支持MAC地址伪装 <code class="docutils literal notranslate"><span class="pre">cloned-mac-addres</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">nmcli</span> <span class="n">con</span> <span class="n">modify</span> <span class="o">&lt;</span><span class="n">con_name</span><span class="o">&gt;</span> <span class="n">wifi</span><span class="o">.</span><span class="n">cloned</span><span class="o">-</span><span class="n">mac</span><span class="o">-</span><span class="n">address</span> <span class="n">XX</span><span class="p">:</span><span class="n">XX</span><span class="p">:</span><span class="n">XX</span><span class="p">:</span><span class="n">XX</span><span class="p">:</span><span class="n">XX</span><span class="p">:</span><span class="n">X</span>
</pre></div>
</div>
<p>这样配置的连接可以自动调整MAC地址</p>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.yeahhub.com/change-mac-address-kali-linux-permanently/">Change Mac Address in Kali Linux(Permanently)</a><span class="link-target"> [https://www.yeahhub.com/change-mac-address-kali-linux-permanently/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>