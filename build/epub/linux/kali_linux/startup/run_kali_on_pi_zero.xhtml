<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>在树莓派Zero W上安装和运行Kali Linux</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="zero-wkali-linux">
<span id="run-kali-on-pi-zero"></span><h1>在树莓派Zero W上安装和运行Kali Linux</h1>
<section id="zero-w">
<h2>树莓派Zero W概述</h2>
<p>正如我在 <a class="reference internal" href="../introduce_kali_linux.xhtml#introduce-kali-linux"><span class="std std-ref">Kali Linux介绍</span></a> 所说的，Kali Linux作为基于Debian开发的面向安全的Linux发行版，天然继承了Debian跨平台的能力，可以在不同硬件平台运行，也包括ARM平台。因此，Kali Linux同样提供了 <a class="reference external" href="https://www.offensive-security.com/kali-linux-arm-images/">ARM不同硬件平台</a><span class="link-target"> [https://www.offensive-security.com/kali-linux-arm-images/]</span> 镜像。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>详细在树莓派上安装操作系统，请参考 <a class="reference internal" href="../../../arm/raspberry_pi/startup/pi_quick_start.xhtml#pi-quick-start"><span class="std std-ref">树莓派(Raspberry Pi)快速起步</span></a> 。</p>
</div>
<p>为了好玩（更Geek一些），我在Raspberry Pi（树莓派）上安装和运行Kali Linux，并且，使用一种称为 <a class="reference external" href="https://www.raspberrypi.org/products/raspberry-pi-zero-w/">Raspberry Pi Zero W</a><span class="link-target"> [https://www.raspberrypi.org/products/raspberry-pi-zero-w/]</span> 的口香糖大小树莓派:</p>
<figure class="align-default">
<img alt="../../../_images/pi_zero_w.jpg" src="../../../_images/pi_zero_w.jpg" />
</figure>
<p>另外，Zero W的USB扩展卡 ( <a class="reference internal" href="../../../arm/raspberry_pi/network/pi_zero_net_gadget.xhtml#pi-zero-net-gadget"><span class="std std-ref">树莓派Zero设置USB网络通讯(Ethernet Gadget)</span></a> )，可以方便地将Kali Linux随身携带，只需要插入主机USB接口就可以工作， 加上一个透明的亚克力保护壳，非常美观：</p>
<figure class="align-default">
<img alt="../../../_images/zero_usb_2.jpg" src="../../../_images/zero_usb_2.jpg" style="width: 500.0px; height: 500.0px;" />
</figure>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>请注意，需要 <a class="reference internal" href="../../../arm/raspberry_pi/network/pi_zero_net_gadget.xhtml#pi-zero-net-gadget"><span class="std std-ref">树莓派Zero设置USB网络通讯(Ethernet Gadget)</span></a> 才能实现通讯。</p>
</div>
</section>
<section id="id1">
<h2>下载和镜像</h2>
<p><a class="reference external" href="https://www.offensive-security.com/kali-linux-arm-images/">Offensive Security官方网站提供Kali Linux ARM Images</a><span class="link-target"> [https://www.offensive-security.com/kali-linux-arm-images/]</span> ，提供了不同ARM版本的镜像，其中不仅有 Raspberry Pi 2/3 的版本，也有 Raspberry Pi Zero W版本。</p>
<p>下载 <a class="reference external" href="https://images.offensive-security.com/arm-images/kali-linux-2018.1-rpi0w-nexmon.img.xz">Raspberry Pi Zero W版本kali-linux-2018.1</a><span class="link-target"> [https://images.offensive-security.com/arm-images/kali-linux-2018.1-rpi0w-nexmon.img.xz]</span> 是 <code class="docutils literal notranslate"><span class="pre">.xz</span></code> 压缩版本（不是ISO），通过一下命令解压缩并写入到U盘（这里实际上是TF卡加了USB套，在linux上显示为 <code class="docutils literal notranslate"><span class="pre">/dev/sdb</span></code> ）:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">xzcat</span> <span class="n">kali</span><span class="o">-</span><span class="n">linux</span><span class="o">-</span><span class="mf">2018.1</span><span class="o">-</span><span class="n">rpi0w</span><span class="o">-</span><span class="n">nexmon</span><span class="o">.</span><span class="n">img</span><span class="o">.</span><span class="n">xz</span> <span class="o">|</span> \
<span class="n">dd</span> <span class="n">bs</span><span class="o">=</span><span class="mi">4</span><span class="n">M</span> <span class="n">of</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb</span> <span class="n">iflag</span><span class="o">=</span><span class="n">fullblock</span> <span class="n">oflag</span><span class="o">=</span><span class="n">direct</span> <span class="n">status</span><span class="o">=</span><span class="n">progress</span>
</pre></div>
</div>
<p>注意：这里使用的 <code class="docutils literal notranslate"><span class="pre">of=/dev/sdb</span></code> 是因为U盘识别为 <code class="docutils literal notranslate"><span class="pre">sdb</span></code> ，具体要看TF卡转成U盘插入Linux系统主机识别的设备名。</p>
</section>
<section id="usb">
<h2>设置USB方式网络通讯</h2>
<p>采用 <a class="reference internal" href="../../../arm/raspberry_pi/network/pi_zero_net_gadget.xhtml#pi-zero-net-gadget"><span class="std std-ref">树莓派Zero设置USB网络通讯(Ethernet Gadget)</span></a> 方式，设置通过USB通讯。所以需要修订树莓派启动配置参数。</p>
<ul>
<li><p>挂载U盘:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb2</span> <span class="o">/</span><span class="n">mnt</span>
<span class="n">sudo</span> <span class="n">mount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sdb1</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">boot</span>
</pre></div>
</div>
</li>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">config.txt</span></code> （Kali Linux默认似乎没有这个文件，所以创建），在最后添加一行:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dtoverlay</span><span class="o">=</span><span class="n">dwc2</span>
</pre></div>
</div>
</li>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">cmdline.txt</span></code> 在 <code class="docutils literal notranslate"><span class="pre">rootwait</span></code> 之后加上一个空格，以及 <code class="docutils literal notranslate"><span class="pre">modules-load=dwc2,g_ether</span></code> 。完整配置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">dwc_otg</span><span class="o">.</span><span class="n">lpm_enable</span><span class="o">=</span><span class="mi">0</span> <span class="n">console</span><span class="o">=</span><span class="n">serial0</span><span class="p">,</span><span class="mi">115200</span> <span class="n">console</span><span class="o">=</span><span class="n">tty1</span> <span class="n">root</span><span class="o">=</span><span class="n">PARTUUID</span><span class="o">=</span><span class="mi">792</span><span class="n">bacf6</span><span class="o">-</span><span class="mi">02</span> <span class="n">rootfstype</span><span class="o">=</span><span class="n">ext4</span> <span class="n">elevator</span><span class="o">=</span><span class="n">deadline</span> <span class="n">fsck</span><span class="o">.</span><span class="n">repair</span><span class="o">=</span><span class="n">yes</span> <span class="n">rootwait</span> <span class="n">modules</span><span class="o">-</span><span class="n">load</span><span class="o">=</span><span class="n">dwc2</span><span class="p">,</span><span class="n">g_ether</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>我修改了Kali Linux的 <code class="docutils literal notranslate"><span class="pre">cmdline.txt</span></code> 文件中 <code class="docutils literal notranslate"><span class="pre">root=/dev/mmcblk0p</span></code> ，改成 <code class="docutils literal notranslate"><span class="pre">root=PARTUUID=792bacf6-02</span></code> 。这是因为我通过USB转接卡后，设备名称会改变，所以通过 <code class="docutils literal notranslate"><span class="pre">PARTUUID</span></code> 来确保设备识别实际不会变化。</p>
</div>
<ul>
<li><p>编辑 <code class="docutils literal notranslate"><span class="pre">/mnt/etc/network/interfaces</span></code> 配置如下:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">allow</span><span class="o">-</span><span class="n">hotplug</span> <span class="n">usb0</span>
<span class="n">iface</span> <span class="n">usb0</span> <span class="n">inet</span> <span class="n">static</span>
        <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.10</span>
        <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
        <span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.0</span>
        <span class="n">broadcast</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.255</span>
        <span class="n">gateway</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.1</span>
        <span class="n">dns</span><span class="o">-</span><span class="n">nameservers</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.1</span>
</pre></div>
</div>
</li>
<li><p>卸载挂载的U盘:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">umount</span> <span class="o">/</span><span class="n">mnt</span><span class="o">/</span><span class="n">boot</span>
<span class="n">sudo</span> <span class="n">umount</span> <span class="o">/</span><span class="n">mnt</span>
</pre></div>
</div>
</li>
</ul>
<p>然后将TF卡插入树莓派Zero W，通过USB方式插入到一台Linux主机上，此时Linux主机会自动发现新的网卡设备，例如 <code class="docutils literal notranslate"><span class="pre">enp0s29u1u1</span></code></p>
<ul>
<li><p>通过在Linux主机上 <code class="docutils literal notranslate"><span class="pre">/etc/network/interfaces</span></code> 添加如下内容:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">auto</span> <span class="n">enp0s29u1u1</span>
<span class="n">iface</span> <span class="n">enp0s29u1u1</span> <span class="n">inet</span> <span class="n">static</span>
        <span class="n">address</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.1</span>
        <span class="n">netmask</span> <span class="mf">255.255</span><span class="o">.</span><span class="mf">255.0</span>
        <span class="n">network</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.0</span>
        <span class="n">broadcast</span> <span class="mf">192.168</span><span class="o">.</span><span class="mf">7.255</span>
</pre></div>
</div>
</li>
</ul>
<p>然后启动 <code class="docutils literal notranslate"><span class="pre">sudo</span> <span class="pre">ifup</span> <span class="pre">enp0s29u1u1</span></code> 网络通了之后，就可以 <code class="docutils literal notranslate"><span class="pre">ssh</span> <span class="pre">192.168.7.10</span></code> ，默认账号 <code class="docutils literal notranslate"><span class="pre">root</span></code> 的密码是 <code class="docutils literal notranslate"><span class="pre">toor</span></code> ，请立即修改。</p>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="http://www.zdnet.com/article/hands-on-kali-linux-2018-1-on-the-raspberry-pi-zero-w/">Hands-On: Kali Linux 2018.1 on the Raspberry Pi Zero W</a><span class="link-target"> [http://www.zdnet.com/article/hands-on-kali-linux-2018-1-on-the-raspberry-pi-zero-w/]</span></p></li>
<li><p><a class="reference external" href="http://www.zdnet.com/article/how-to-customise-your-linux-desktop-kali-linux-and-i3-window-manager/">How to customise your Linux desktop: Kali Linux and i3 Window Manager</a><span class="link-target"> [http://www.zdnet.com/article/how-to-customise-your-linux-desktop-kali-linux-and-i3-window-manager/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>