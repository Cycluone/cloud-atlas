<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>XFS文件系统</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="xfs">
<span id="id1"></span><h1>XFS文件系统</h1>
<section id="id2">
<h2>安装和修复XFS</h2>
<ul>
<li><p>安装XFS管理工具 <code class="docutils literal notranslate"><span class="pre">xfsprogs</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">xfsprogs</span>
</pre></div>
</div>
</li>
<li><p>如果需要修复XFS文件系统，需要先umount之后再修复:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">umount</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span>
<span class="n">xfs_repair</span> <span class="o">-</span><span class="n">v</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">sda3</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="xfs-scrub">
<h2>XFS在线元数据检验(scrub)</h2>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>XFS的scrub可以用来检验元数据，但是这是一个试验性质程序。</p>
</div>
<p><code class="docutils literal notranslate"><span class="pre">xfs_scrub</span></code> 会查询内核有有关XFS文件系统所有元数据独爱想。元数据记录被扫描检查明显损坏值然后交叉应用另一个元数据。目的是通过检查单个元数据记录相对于文件系统中其他元数据的一致性来建立对整个文件系统一致性的合理信心。如果存在完整的冗余数据结构，则可以从其他元数据重建损坏的元数据。</p>
<p>通过启动和激活 <code class="docutils literal notranslate"><span class="pre">xfs_scrub_all.timer</span></code> 来周期性检查在线XFS文件系统的元数据。</p>
</section>
<section id="id3">
<h2>XFS元数据校验</h2>
<p>xfsprogs 3.2.0引入了一个磁盘格式v5包含了元数据校验和机制，称为”自描述元数据”(Self-Describing Metadata)，基于CRC32，提供了对于元数据的附加保护，避免电源故障时发生意外。从xfsprogs 3.2.3开始默认激活了校验，不过对于比较旧哦内核，可以通过 <code class="docutils literal notranslate"><span class="pre">-m</span> <span class="pre">crc=0</span></code> 关闭校验:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">mkfs</span><span class="o">.</span><span class="n">xfs</span> <span class="o">-</span><span class="n">m</span> <span class="n">crc</span><span class="o">=</span><span class="mi">0</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">target_partition</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>XFS性能</h2>
<p>在RAID社别上使用XFS时候，有可能通过使用 <code class="docutils literal notranslate"><span class="pre">largeio</span></code> , <code class="docutils literal notranslate"><span class="pre">swalloc</span></code> 参数值增加来提高性能。参考:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://help.marklogic.com/Knowledgebase/Article/View/505/0/recommended-xfs-settings-for-marklogic-server">Recommended XFS settings for MarkLogic Server</a><span class="link-target"> [https://help.marklogic.com/Knowledgebase/Article/View/505/0/recommended-xfs-settings-for-marklogic-server]</span></p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>MarkLogic Server是面向文档的No-SQL数据库，上文提供了XFS优化策略可以参考实践。</p>
</div>
</section>
<section id="id5">
<h2>XFS条带大小和宽度</h2>
<p>如果文件系统建立在条代化的RAID之上，通过 <code class="docutils literal notranslate"><span class="pre">mkfs.xfs</span></code> 命令参数设置特定条带大小可以显著提升性能。XFS有时能够检查出底层软RAID的分布，但是对于硬件RAID，请参考 <a class="reference external" href="http://xfs.org/index.php/XFS_FAQ#Q:_How_to_calculate_the_correct_sunit.2Cswidth_values_for_optimal_performance">how to calculate the correct sunit,swidth values for optimal performance</a><span class="link-target"> [http://xfs.org/index.php/XFS_FAQ#Q:_How_to_calculate_the_correct_sunit.2Cswidth_values_for_optimal_performance]</span></p>
<section id="id6">
<h3>参考</h3>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.archlinux.org/index.php/XFS">Arch Linux社区文档 - XFS</a><span class="link-target"> [https://wiki.archlinux.org/index.php/XFS]</span></p></li>
</ul>
</section>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>