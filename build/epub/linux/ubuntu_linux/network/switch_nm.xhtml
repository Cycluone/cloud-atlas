<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>切换NetworkManager</title>
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="networkmanager">
<span id="switch-nm"></span><h1>切换NetworkManager</h1>
<p>在Ubuntu桌面和服务器版本，默认使用不同的网络配置工具:</p>
<ul class="simple">
<li><p>桌面版本使用NetworkManager (NetworkManager适合桌面GUI使用)</p></li>
<li><p>服务器版本使用 <a class="reference internal" href="netplan.xhtml#netplan"><span class="std std-ref">netplan网络配置</span></a> 来配置 <code class="docutils literal notranslate"><span class="pre">systemd-networkd</span></code> (不过netplan也支持NetworkManager作为后端)</p></li>
</ul>
<p>在部署树莓派集群时，我采用完全字符模式运行，虽然安装的 <a class="reference internal" href="../../../machine_learning/jetson/index.xhtml#jetson"><span class="std std-ref">NVIDIA Jetson</span></a> 是NVIDIA L4T的Ubuntu桌面版本，我还是切换成netplan进行配置，不仅统一管理，而且节约了NetworkManager占用的资源。</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Jetson Nano的Ubuntu版本netplan使用不如树莓派Ubuntu 20.04，很多管理操作命令方法和netplan官方文档不同，所以我最后放弃了在Jetson Nano的Ubuntu 18.04上使用netplan，返回直接使用NetworkManager进行管理 - 配置无线方法参考 <a class="reference internal" href="../ubuntu_on_mbp.xhtml#ubuntu-on-mbp"><span class="std std-ref">MacBook Pro上运行Ubuntu</span></a></p>
</div>
<section id="network-managersystemd-networkd">
<h2>停用Network Manager并激活systemd-networkd</h2>
<ul>
<li><p>禁用NetworkManager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">stop</span> <span class="n">NetworkManager</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">NetworkManager</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">mask</span> <span class="n">NetworkManager</span>
</pre></div>
</div>
</li>
<li><p>启动和激活 <code class="docutils literal notranslate"><span class="pre">systemd-networkd</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">unmask</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
<li><p>netplan配置位于 <code class="docutils literal notranslate"><span class="pre">/etc/netplan</span></code> 目录，如果这个目录不存在，首先创建。然后针对网卡添加配置</p></li>
</ul>
<p>举例，添加dhcp配置:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span><span class="p">:</span>
  <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">renderer</span><span class="p">:</span> <span class="n">networkd</span>
  <span class="n">ethernets</span><span class="p">:</span>
    <span class="n">enp0s3</span><span class="p">:</span>
      <span class="n">dhcp4</span><span class="p">:</span> <span class="n">yes</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>我采用配置是静态IP地址配置，采用 <a class="reference internal" href="netplan.xhtml#netplan"><span class="std std-ref">netplan网络配置</span></a> 配置方法，不再重复。</p>
</div>
<ul>
<li><p>完成配置后，执行以下命令生效:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">netplan</span> <span class="n">apply</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="networkmanagersystemd-networkd">
<h2>反向操作：激活NetworkManager关闭systemd-networkd</h2>
<p>以下操作可以反向关闭netplan，重新使用NetworkManager，不过这种方式不建议在Ubuntu server上使用。</p>
<ul>
<li><p>停止 <code class="docutils literal notranslate"><span class="pre">systemd-networkd</span></code> 服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">mask</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">stop</span> <span class="n">systemd</span><span class="o">-</span><span class="n">networkd</span><span class="o">.</span><span class="n">service</span>
</pre></div>
</div>
</li>
<li><p>安装NetworkManager:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">network</span><span class="o">-</span><span class="n">manager</span>
</pre></div>
</div>
</li>
<li><p>在 <code class="docutils literal notranslate"><span class="pre">/etc/netplan</span></code> 目录下将配置文件 <code class="docutils literal notranslate"><span class="pre">.yaml</span></code> 中配置修改成使用 <code class="docutils literal notranslate"><span class="pre">NetworkManager</span></code> 作为 <code class="docutils literal notranslate"><span class="pre">renderer</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">network</span><span class="p">:</span>
  <span class="n">version</span><span class="p">:</span> <span class="mi">2</span>
  <span class="n">renderer</span><span class="p">:</span> <span class="n">NetworkManager</span>
</pre></div>
</div>
</li>
<li><p>然后使用netplan命令生成NetworkManager的后端特定配置文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">netplan</span> <span class="n">generate</span>
</pre></div>
</div>
</li>
<li><p>启动NetworkManager服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">unmask</span> <span class="n">NetworkManager</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="n">NetworkManager</span>
<span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">start</span> <span class="n">NetworkManager</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>虽然可以在Ubuntu Server版本上通过NetworkManager管理网络，但是从Ubuntu Server 18.04开始，服务器版本已经全面采用 <code class="docutils literal notranslate"><span class="pre">systemd-networkd</span></code> 并使用 <a class="reference internal" href="netplan.xhtml#netplan"><span class="std std-ref">netplan网络配置</span></a> 来替代NetworkManager配置网络。所以，不建议在服务器上使用NetworkManager。</p>
</div>
</section>
<section id="id1">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.configserverfirewall.com/ubuntu-linux/ubuntu-network-manager/">Ubuntu Network Manager: Enabling and disabling NetworkManager on Ubuntu</a><span class="link-target"> [https://www.configserverfirewall.com/ubuntu-linux/ubuntu-network-manager/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>