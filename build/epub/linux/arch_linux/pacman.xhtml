<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Pacman</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="pacman">
<span id="id1"></span><h1>Pacman</h1>
<p>pacman是arch linux的主要包管理工具。它包含了简单的二进制包格式和易于使用的编译体系。通过和主服务器同步pacman可以保持系统的软件包更新，其服务器/客户对模式允许用户下载和安装软件包以及所有依赖软件包。</p>
<section id="id2">
<h2>pacman简明使用</h2>
<ul>
<li><p>安装软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">package_name1</span> <span class="n">package_name2</span> <span class="o">...</span>
</pre></div>
</div>
</li>
<li><p>使用正则方式安装一系列软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>pacman -S $(pacman -Ssq package_regex)
</pre></div>
</div>
</li>
<li><p>如果有多个软件包位于不同仓库，例如extra仓库和testing仓库，则在软件包前加上仓库定义:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">extra</span><span class="o">/</span><span class="n">package_name</span>
</pre></div>
</div>
</li>
<li><p>支持简单的名字模式:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">plasma</span><span class="o">-</span><span class="p">{</span><span class="n">desktop</span><span class="p">,</span><span class="n">mediacenter</span><span class="p">,</span><span class="n">nm</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>甚至支持多级扩展:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">plasma</span><span class="o">-</span><span class="p">{</span><span class="n">workspace</span><span class="p">{,</span><span class="o">-</span><span class="n">wallpapers</span><span class="p">}</span><span class="o">&lt;</span><span class="n">Plug</span><span class="o">&gt;</span><span class="n">PeepOpena</span><span class="p">}</span>
</pre></div>
</div>
</li>
<li><p>一些软件包支持整组安装，例如gnome:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">S</span> <span class="n">gnome</span>
</pre></div>
</div>
</li>
</ul>
<p>要检查这个组中包含的软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Sg</span> <span class="n">gnome</span>
</pre></div>
</div>
<ul>
<li><p>删除单一软件包，但是保留已经安装的这个软件包的依赖:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">R</span> <span class="n">package_name</span>
</pre></div>
</div>
</li>
<li><p>删除软件包并且删除所有没有被其他软件包所使用的该软件包的依赖:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Rs</span> <span class="n">package_name</span>
</pre></div>
</div>
</li>
<li><p>删除软件包，该软件包被其他软件包所使用，但是不删除依赖软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Rdd</span> <span class="n">package_name</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">警告</p>
<p>上述命令会打破系统完整，所以需要避免</p>
</div>
<ul>
<li><p>升级整个系统所有软件包:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Syu</span>
</pre></div>
</div>
</li>
<li><p>清理缓存:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Sc</span>
</pre></div>
</div>
</li>
<li><p>查询系统中安装的某个程序属于哪个软件包提供(这里举例查询netstat命令):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacmsn</span> <span class="o">-</span><span class="n">Qo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">netstat</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="break-dependency">
<h2>break dependency</h2>
<p>执行 <code class="docutils literal notranslate"><span class="pre">pacman</span> <span class="pre">-Syu</span></code> 时候遇到报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">looking</span> <span class="k">for</span> <span class="n">conflicting</span> <span class="n">packages</span><span class="o">...</span>
<span class="n">error</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">prepare</span> <span class="n">transaction</span> <span class="p">(</span><span class="n">could</span> <span class="ow">not</span> <span class="n">satisfy</span> <span class="n">dependencies</span><span class="p">)</span>
<span class="p">::</span> <span class="n">installing</span> <span class="n">xorgproto</span> <span class="p">(</span><span class="mf">2019.2</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="n">breaks</span> <span class="n">dependency</span> <span class="s1">&#39;xf86miscproto&#39;</span> <span class="n">required</span> <span class="n">by</span> <span class="n">libxxf86misc</span>
</pre></div>
</div>
<p>参考 <a class="reference external" href="https://bbs.archlinux.org/viewtopic.php?id=251517">xorgproto issues..</a><span class="link-target"> [https://bbs.archlinux.org/viewtopic.php?id=251517]</span> 处理:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Rdd</span> <span class="n">libxxf86misc</span> <span class="o">&amp;&amp;</span> <span class="n">pacman</span> <span class="o">-</span><span class="n">Syu</span>
</pre></div>
</div>
</section>
<section id="signature-error">
<h2>signature error</h2>
<p>执行 <code class="docutils literal notranslate"><span class="pre">pacman</span> <span class="pre">-Syu</span></code> 出现报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">:</span> <span class="n">pacman</span><span class="p">:</span> <span class="n">signature</span> <span class="kn">from</span> <span class="s2">&quot;Levente Polyak (anthraxx) &lt;levente@leventepolyak.net&gt;&quot;</span> <span class="ow">is</span> <span class="n">unknown</span> <span class="n">trust</span>
<span class="p">::</span> <span class="n">File</span> <span class="o">/</span><span class="n">var</span><span class="o">/</span><span class="n">cache</span><span class="o">/</span><span class="n">pacman</span><span class="o">/</span><span class="n">pkg</span><span class="o">/</span><span class="n">pacman</span><span class="o">-</span><span class="mf">5.2</span><span class="o">.</span><span class="mi">1</span><span class="o">-</span><span class="mi">4</span><span class="o">-</span><span class="n">x86_64</span><span class="o">.</span><span class="n">pkg</span><span class="o">.</span><span class="n">tar</span><span class="o">.</span><span class="n">zst</span> <span class="ow">is</span> <span class="n">corrupted</span> <span class="p">(</span><span class="n">invalid</span> <span class="ow">or</span> <span class="n">corrupted</span> <span class="n">package</span> <span class="p">(</span><span class="n">PGP</span> <span class="n">signature</span><span class="p">))</span><span class="o">.</span>
</pre></div>
</div>
<p>上述问题参考 <a class="reference external" href="https://wiki.archlinux.org/index.php/Pacman/Package_signing">pacman/Package signing</a><span class="link-target"> [https://wiki.archlinux.org/index.php/Pacman/Package_signing]</span> 和 <a class="reference external" href="https://bbs.archlinux.org/viewtopic.php?id=207957">Signature is unknown trust [SOLVED]</a><span class="link-target"> [https://bbs.archlinux.org/viewtopic.php?id=207957]</span> 原因是系统长时间没有更新，本地使用的key已经过期，需要重新刷新:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span><span class="o">-</span><span class="n">key</span> <span class="o">--</span><span class="n">refresh</span><span class="o">-</span><span class="n">keys</span>
</pre></div>
</div>
</section>
<section id="conflicting-files">
<h2>conflicting files</h2>
<p>执行 <code class="docutils literal notranslate"><span class="pre">pacman</span> <span class="pre">-Syu</span></code> 提示报错:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">:</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">commit</span> <span class="n">transaction</span> <span class="p">(</span><span class="n">conflicting</span> <span class="n">files</span><span class="p">)</span>
<span class="n">nss</span><span class="p">:</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">p11</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="n">trust</span><span class="o">.</span><span class="n">so</span> <span class="n">exists</span> <span class="ow">in</span> <span class="n">filesystem</span>
<span class="n">Errors</span> <span class="n">occurred</span><span class="p">,</span> <span class="n">no</span> <span class="n">packages</span> <span class="n">were</span> <span class="n">upgraded</span><span class="o">.</span>
</pre></div>
</div>
<p>这个问题参考 <a class="reference external" href="https://wiki.archlinux.org/index.php/Pacman">archlinux - pacman</a><span class="link-target"> [https://wiki.archlinux.org/index.php/Pacman]</span> 中 <code class="docutils literal notranslate"><span class="pre">&quot;Failed</span> <span class="pre">to</span> <span class="pre">commit</span> <span class="pre">transaction</span> <span class="pre">(conflicting</span> <span class="pre">files)&quot;</span> <span class="pre">error</span></code> 解决方法:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">pacman</span> <span class="o">-</span><span class="n">Qo</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">p11</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="n">trust</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>检查看看是否有软件包包含这个文件:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">error</span><span class="p">:</span> <span class="n">No</span> <span class="n">package</span> <span class="n">owns</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">p11</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="n">trust</span><span class="o">.</span><span class="n">so</span>
</pre></div>
</div>
<p>然后将这个文件重命名:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">mv</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">p11</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="n">trust</span><span class="o">.</span><span class="n">so</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">p11</span><span class="o">-</span><span class="n">kit</span><span class="o">-</span><span class="n">trust</span><span class="o">.</span><span class="n">so</span><span class="o">.</span><span class="n">bak</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://wiki.archlinux.org/index.php/Pacman">archlinux - pacman</a><span class="link-target"> [https://wiki.archlinux.org/index.php/Pacman]</span></p></li>
<li><p><a class="reference external" href="https://bbs.archlinux.org/viewtopic.php?id=251517">xorgproto issues..</a><span class="link-target"> [https://bbs.archlinux.org/viewtopic.php?id=251517]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>