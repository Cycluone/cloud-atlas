<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Ring Buffer / DMA / MMIO</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="ring-buffer-dma-mmio">
<span id="id1"></span><h1>Ring Buffer / DMA / MMIO</h1>
<p>在我们使用 <a class="reference internal" href="ethtool/index.xhtml#ethtool"><span class="std std-ref">ethtool - 控制网络驱动和硬件</span></a> debug网络故障和优化网络性能时，会发现ethtool工具提供了很多底层硬件控制，包括DMA ring size调整。我们也经常会在手册中看到DMA这个概念。那么在Linux网络中，以太网的Ring Buffer以及DMA是什么原理，我们又该如何根据实际情况来调整参数呢？</p>
<section id="dma">
<h2>DMA</h2>
<p>DMA (Direct Memory Access) 顾名思义就是 “直接内存访问”，是指一个设备和CPU共享内存总线。DMA有主要优点： 通过和CPU共享内存总线，DMA可以实现IO设备和内存之间快速的数据复制(不论内存到设备还是设备到内存，都能够加速数据传输)。</p>
<p>DMA是一种古老的技术，甚至比主板发明的历史更救援，早在上个世纪1950年代到60年代，就已经在硬件上使用了DMA。</p>
</section>
<section id="mmio">
<h2>MMIO</h2>
<p>MMIO(Memory Mapped Input Output) 内存映射输入输出，是一种允许CPU和硬件设备通讯的替代方案。MMIO设备的内存驻留地址完全任意。MMIO的优点是CPU架构不需要特殊设置就可以从硬件设备读取或写入数据。</p>
</section>
<section id="ring-buffer">
<h2>Ring Buffer</h2>
<p>Ring Buffer 或 Circular Buffer (环形缓存) 是主内存的一段用于存储和获取数据的部分。通常用于FIFO(First In First Out, 先进先出)访问方式。Ring Buffer除了用于网卡数据包，它也被用于串口通讯。广义上，Ring Buffer的实现包括了一个存(put)指针和一个取(get)指针，以及在缓存中的对象计数(count of the number of items)。当更新最新对象的指针(就是最高地址)就是最早指针(也就是最低地址)，两者相等时表示这两个指针都在缓存的开始位置，也表明缓存已经清空。</p>
<p>当你把对象放入Ring Buffer，则put指针就移到下一个位置，此时指针就不相等，也就表示缓存中有数据。当你</p>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>Ring Buffer是一个环形堆栈，当最晚指针和最早指针重合，就表明缓存被清空。</p>
</div>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://forum.allaboutcircuits.com/threads/ring-buffer-dma-mmio-explanation-is-needed.135998/">Ring Buffer / DMA / MMIO explanation is needed</a><span class="link-target"> [https://forum.allaboutcircuits.com/threads/ring-buffer-dma-mmio-explanation-is-needed.135998/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>