<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>在CentOS 8上安装Docker CE</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="centos-8docker-ce">
<span id="install-docker-centos8"></span><h1>在CentOS 8上安装Docker CE</h1>
<p>在 <a class="reference internal" href="../../kubernetes/virtual/gvisor/gvisor_quickstart.xhtml#gvisor-quickstart"><span class="std std-ref">gVisor快速起步</span></a> 中，我在CentOS 8系统中构建gVisor编译安装环境，其中使用了Docker CE安装部署，本文作为通用安装指南，汇总CentOS 8操作系统安装Docker CE的步骤。</p>
<section id="docker-ce">
<h2>添加Docker CE仓库</h2>
<p>当前CentOS发行版和EPEL都没有提供gVisor安装包，需要从源代码编译。运行gVisor需安装docker。</p>
<ul>
<li><p>docker仓库:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># 添加docker-ce仓库</span>
<span class="n">sudo</span> <span class="n">dnf</span> <span class="n">config</span><span class="o">-</span><span class="n">manager</span> <span class="o">--</span><span class="n">add</span><span class="o">-</span><span class="n">repo</span><span class="o">=</span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">.</span><span class="n">repo</span>

<span class="c1"># 检查所有仓库列表</span>
<span class="n">sudo</span> <span class="n">dnf</span> <span class="n">repolist</span> <span class="o">-</span><span class="n">v</span>
<span class="c1"># 将所有docker-ce版本列出</span>
<span class="n">dnf</span> <span class="nb">list</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span> <span class="o">--</span><span class="n">showduplicates</span> <span class="o">|</span> <span class="n">sort</span> <span class="o">-</span><span class="n">r</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>2021年初验证发现Docker已经提供了CentOS 8版本，已经不再需要强制安装原先针对CentOS 7的containerd了。</p>
</div>
</section>
<section id="id1">
<h2>安装docker-ce</h2>
<p>安装docker-ce有两种模式，一种是直接使用仓库中最佳可用版本，使用参数 <code class="docutils literal notranslate"><span class="pre">--nobest</span></code> 则安装的是stable版本 ；另一种是使用最新的可用版本，则不需要参数，但是这种安装模式需要最新的contained(没有包含在软件仓库)。</p>
<ul>
<li><p>方法一：最简洁方便的安装方式，安装稳定版本:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dnf</span> <span class="n">install</span> <span class="o">--</span><span class="n">nobest</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span>
</pre></div>
</div>
</li>
<li><p>方法二：安装最新可用版本(现在已经不用指定了，所以这个方法建议忽略)</p></li>
</ul>
<p>安装最新可用版本需要先安装必要的containerd.io，不过有多个containerd.io版本，执行 <code class="docutils literal notranslate"><span class="pre">dnf</span> <span class="pre">install</span> <span class="pre">docker-ce</span></code> 时会提示:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Error</span><span class="p">:</span>
 <span class="n">Problem</span><span class="p">:</span> <span class="n">package</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span><span class="o">-</span><span class="mi">3</span><span class="p">:</span><span class="mf">19.03</span><span class="o">.</span><span class="mi">8</span><span class="o">-</span><span class="mf">3.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span> <span class="n">requires</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span> <span class="o">&gt;=</span> <span class="mf">1.2</span><span class="o">.</span><span class="mi">2</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="n">but</span> <span class="n">none</span> <span class="n">of</span> <span class="n">the</span> <span class="n">providers</span> <span class="n">can</span> <span class="n">be</span> <span class="n">installed</span>
 <span class="o">-</span> <span class="n">cannot</span> <span class="n">install</span> <span class="n">the</span> <span class="n">best</span> <span class="n">candidate</span> <span class="k">for</span> <span class="n">the</span> <span class="n">job</span>
 <span class="o">-</span> <span class="n">package</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">10</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span> <span class="ow">is</span> <span class="n">excluded</span>
 <span class="o">-</span> <span class="n">package</span> <span class="n">containerd</span><span class="o">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">13</span><span class="o">-</span><span class="mf">3.1</span><span class="o">.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span> <span class="ow">is</span> <span class="n">excluded</span>
 <span class="o">...</span>
</pre></div>
</div>
<p>所以先安装containerd.io:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dnf</span> <span class="n">install</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">download</span><span class="o">.</span><span class="n">docker</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">linux</span><span class="o">/</span><span class="n">centos</span><span class="o">/</span><span class="mi">7</span><span class="o">/</span><span class="n">x86_64</span><span class="o">/</span><span class="n">stable</span><span class="o">/</span><span class="n">Packages</span><span class="o">/</span><span class="n">containerd</span><span class="o">.</span><span class="n">io</span><span class="o">-</span><span class="mf">1.2</span><span class="o">.</span><span class="mi">13</span><span class="o">-</span><span class="mf">3.2</span><span class="o">.</span><span class="n">el7</span><span class="o">.</span><span class="n">x86_64</span><span class="o">.</span><span class="n">rpm</span>
</pre></div>
</div>
<p>然后执行安装docker-ce:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">dnf</span> <span class="n">install</span> <span class="n">docker</span><span class="o">-</span><span class="n">ce</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>之前2020年中，我在 <a class="reference internal" href="../docker_in_docker/index.xhtml#docker-in-docker"><span class="std std-ref">Docker in Docker</span></a> 环境部署持续集成系统，采用的方法2。到2021年初验证，已经可以直接采用方法1了，因为Docker已经提供了CentOS 8的原生版本。</p>
</div>
<ul>
<li><p>关闭firewalld:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">disable</span> <span class="n">firewalld</span>
</pre></div>
</div>
</li>
<li><p>启动和激活docker服务:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">sudo</span> <span class="n">systemctl</span> <span class="n">enable</span> <span class="o">--</span><span class="n">now</span> <span class="n">docker</span>
</pre></div>
</div>
</li>
</ul>
</section>
<section id="docker-compose">
<h2>安装docker-compose(可选)</h2>
<p>docker-compose可以帮助管理多容器应用，类似 <a class="reference internal" href="../../kubernetes/concepts/workloads/pods/index.xhtml#k8s-workloads-pods"><span class="std std-ref">Kubernetes Pods</span></a> ，组合多个容器形成应用服务架构。不过，需要独立手工安装:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">curl</span> <span class="o">-</span><span class="n">L</span> <span class="s2">&quot;https://github.com/docker/compose/releases/download/1.23.2/docker-compose-$(uname -s)-$(uname -m)&quot;</span> <span class="o">-</span><span class="n">o</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span>
<span class="n">sudo</span> <span class="n">mv</span> <span class="n">docker</span><span class="o">-</span><span class="n">compose</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span> <span class="o">&amp;&amp;</span> <span class="n">sudo</span> <span class="n">chmod</span> <span class="o">+</span><span class="n">x</span> <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">local</span><span class="o">/</span><span class="nb">bin</span><span class="o">/</span><span class="n">docker</span><span class="o">-</span><span class="n">compose</span>
</pre></div>
</div>
</section>
<section id="id2">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://www.linuxtechi.com/install-docker-ce-centos-8-rhel-8/">How to Install Docker CE on CentOS 8 / RHEL 8</a><span class="link-target"> [https://www.linuxtechi.com/install-docker-ce-centos-8-rhel-8/]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>