<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xmlns:epub="http://www.idpf.org/2007/ops">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>添加host设备到容器</title>
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/epub.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/theme_overrides.css" type="text/css" /> 
  </head><body>

    <div class="document">
      <div class="documentwrapper">
          <div class="body" role="main">
            
  <section id="host">
<span id="docker-run-add-host-device"></span><h1>添加host设备到容器</h1>
<section id="hostlvm">
<h2>Host主机LVM卷映射添加到容器</h2>
<p>在 <a class="reference internal" href="../../ceph/ceph_docker_in_studio.xhtml#ceph-docker-in-studio"><span class="std std-ref">Stuido环境Docker容器运行Ceph</span></a> 创建了5个LVM卷设备，分别准备用于5个Ceph容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ls</span> <span class="o">-</span><span class="n">lh</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">mapper</span><span class="o">/</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>       <span class="mi">7</span> <span class="mi">4</span><span class="n">月</span>  <span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="n">ceph</span><span class="o">-</span><span class="n">data1</span> <span class="o">-&gt;</span> <span class="o">../</span><span class="n">dm</span><span class="o">-</span><span class="mi">0</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>       <span class="mi">7</span> <span class="mi">4</span><span class="n">月</span>  <span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="n">ceph</span><span class="o">-</span><span class="n">data2</span> <span class="o">-&gt;</span> <span class="o">../</span><span class="n">dm</span><span class="o">-</span><span class="mi">1</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>       <span class="mi">7</span> <span class="mi">4</span><span class="n">月</span>  <span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="n">ceph</span><span class="o">-</span><span class="n">data3</span> <span class="o">-&gt;</span> <span class="o">../</span><span class="n">dm</span><span class="o">-</span><span class="mi">2</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>       <span class="mi">7</span> <span class="mi">4</span><span class="n">月</span>  <span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="n">ceph</span><span class="o">-</span><span class="n">data4</span> <span class="o">-&gt;</span> <span class="o">../</span><span class="n">dm</span><span class="o">-</span><span class="mi">3</span>
<span class="n">lrwxrwxrwx</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">root</span>       <span class="mi">7</span> <span class="mi">4</span><span class="n">月</span>  <span class="mi">11</span> <span class="mi">10</span><span class="p">:</span><span class="mi">00</span> <span class="n">ceph</span><span class="o">-</span><span class="n">data5</span> <span class="o">-&gt;</span> <span class="o">../</span><span class="n">dm</span><span class="o">-</span><span class="mi">4</span>
</pre></div>
</div>
<ul>
<li><p>创建:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">docker</span> <span class="n">run</span> <span class="o">-</span><span class="n">itd</span> <span class="o">--</span><span class="n">hostname</span> <span class="n">ceph</span><span class="o">-</span><span class="mi">1</span> <span class="o">--</span><span class="n">name</span> <span class="n">ceph</span><span class="o">-</span><span class="mi">1</span> <span class="o">-</span><span class="n">v</span> <span class="n">data</span><span class="p">:</span><span class="o">/</span><span class="n">data</span> \
   <span class="o">--</span><span class="n">net</span> <span class="n">ceph</span><span class="o">-</span><span class="n">net</span> <span class="o">--</span><span class="n">ip</span> <span class="mf">172.18</span><span class="o">.</span><span class="mf">0.11</span> \
   <span class="o">--</span><span class="n">device</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">mapper</span><span class="o">/</span><span class="n">ceph</span><span class="o">-</span><span class="n">data1</span><span class="p">:</span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvdc</span> <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>
</pre></div>
</div>
</li>
<li><p>登陆 <code class="docutils literal notranslate"><span class="pre">ceph-1</span></code> 容器内部检查磁盘设备:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">root</span><span class="nd">@ceph</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span><span class="o">/</span><span class="c1"># ls -lh /dev/xvdc</span>
<span class="n">brw</span><span class="o">-</span><span class="n">rw</span><span class="o">----</span> <span class="mi">1</span> <span class="n">root</span> <span class="n">disk</span> <span class="mi">253</span><span class="p">,</span> <span class="mi">0</span> <span class="n">Apr</span> <span class="mi">11</span> <span class="mi">02</span><span class="p">:</span><span class="mi">17</span> <span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="n">xvdc</span>
</pre></div>
</div>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">注解</p>
<p>现在在容器 <code class="docutils literal notranslate"><span class="pre">ceph-1</span></code> 内部可以使用这个块设备，也就可以部署Ceph服务了。</p>
</div>
<p>按照上述方法重复，再创建4个ceph容器，分别命名为 <code class="docutils literal notranslate"><span class="pre">ceph-2</span></code> 到 <code class="docutils literal notranslate"><span class="pre">ceph-5</span></code> 备用，具体IP地址参考 <a class="reference internal" href="../../studio/studio_ip.xhtml#studio-ip"><span class="std std-ref">Studio测试环境IP分配</span></a></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>for i in {2..5};do
  docker run -itd --hostname ceph-$i --name ceph-$i -v data:/data \
      --net ceph-net --ip 172.18.0.1$i \
      --device=/dev/mapper/ceph-data$i:/dev/xvdc local:ubuntu18.04-ssh
done
</pre></div>
</div>
<p>完成后使用 <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">ps</span></code> 检查应该具备如下5个容器:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CONTAINER</span> <span class="n">ID</span>        <span class="n">IMAGE</span>                   <span class="n">COMMAND</span>                  <span class="n">CREATED</span>             <span class="n">STATUS</span>              <span class="n">PORTS</span>               <span class="n">NAMES</span>
<span class="mi">98</span><span class="n">b6eb9374eb</span>        <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>   <span class="s2">&quot;/bin/sh -c &#39;/usr/sb…&quot;</span>   <span class="mi">51</span> <span class="n">seconds</span> <span class="n">ago</span>      <span class="n">Up</span> <span class="mi">50</span> <span class="n">seconds</span>       <span class="mi">1122</span><span class="o">/</span><span class="n">tcp</span>            <span class="n">ceph</span><span class="o">-</span><span class="mi">5</span>
<span class="mi">0</span><span class="n">d1d9bf1db2f</span>        <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>   <span class="s2">&quot;/bin/sh -c &#39;/usr/sb…&quot;</span>   <span class="mi">2</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="n">Up</span> <span class="mi">2</span> <span class="n">minutes</span>        <span class="mi">1122</span><span class="o">/</span><span class="n">tcp</span>            <span class="n">ceph</span><span class="o">-</span><span class="mi">4</span>
<span class="n">abfd47525b91</span>        <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>   <span class="s2">&quot;/bin/sh -c &#39;/usr/sb…&quot;</span>   <span class="mi">2</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="n">Up</span> <span class="mi">2</span> <span class="n">minutes</span>        <span class="mi">1122</span><span class="o">/</span><span class="n">tcp</span>            <span class="n">ceph</span><span class="o">-</span><span class="mi">3</span>
<span class="mi">692665</span><span class="n">ba620c</span>        <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>   <span class="s2">&quot;/bin/sh -c &#39;/usr/sb…&quot;</span>   <span class="mi">2</span> <span class="n">minutes</span> <span class="n">ago</span>       <span class="n">Up</span> <span class="mi">2</span> <span class="n">minutes</span>        <span class="mi">1122</span><span class="o">/</span><span class="n">tcp</span>            <span class="n">ceph</span><span class="o">-</span><span class="mi">2</span>
<span class="mi">93</span><span class="n">b0abd529e7</span>        <span class="n">local</span><span class="p">:</span><span class="n">ubuntu18</span><span class="o">.</span><span class="mi">04</span><span class="o">-</span><span class="n">ssh</span>   <span class="s2">&quot;/bin/sh -c &#39;/usr/sb…&quot;</span>   <span class="n">About</span> <span class="n">an</span> <span class="n">hour</span> <span class="n">ago</span>   <span class="n">Up</span> <span class="n">About</span> <span class="n">an</span> <span class="n">hour</span>    <span class="mi">1122</span><span class="o">/</span><span class="n">tcp</span>            <span class="n">ceph</span><span class="o">-</span><span class="mi">1</span>
</pre></div>
</div>
</section>
<section id="id1">
<h2>参考</h2>
<ul class="simple">
<li><p><a class="reference external" href="https://docs.docker.com/engine/reference/commandline/run/#add-host-device-to-container---device">Docker run - Add host device to container (–device)</a><span class="link-target"> [https://docs.docker.com/engine/reference/commandline/run/#add-host-device-to-container---device]</span></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
      </div>
      <div class="clearer"></div>
    </div>
  </body>
</html>